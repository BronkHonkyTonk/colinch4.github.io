---
layout: post
title: "[파이썬] Scrapy의 성능 최적화"
description: " "
date: 2023-09-06
tags: [python,Scrapy]
comments: true
share: true
---

Scrapy는 Python으로 작성된 고성능 웹 크롤링 프레임워크입니다. 이 프레임워크를 사용하면 멀티 스레딩, 비동기 처리, 프록시 rotation과 같은 다양한 기능을 활용하여 큰 규모의 웹 데이터를 효과적으로 수집할 수 있습니다. 하지만 대량의 데이터를 처리할 때 성능 문제가 발생할 수 있으며, 이를 최적화하는 것이 중요합니다.

이 블로그 포스트에서는 Scrapy에서 성능을 최적화하는 몇 가지 방법을 살펴보겠습니다.

## 1. Robots.txt 확인하기

Robots.txt는 웹 사이트가 웹 크롤러에게 허용되거나 금지되는 경로를 지정하는 파일입니다. Scrapy는 기본적으로 Robots.txt를 따르므로, 크롤링할 사이트의 Robots.txt를 확인하는 것이 중요합니다. 때로는 크롤링이 금지되어 있는 경로를 크롤링하거나, 반대로 필요한 경로를 크롤링하지 못하는 경우가 있을 수 있습니다. Robots.txt의 제한 사항을 제거함으로써 크롤링 성능을 향상시킬 수 있습니다.

```python
# robots.txt를 따르지 않도록 설정
ROBOTSTXT_OBEY = False
```

## 2. 대기 시간 조정하기

Scrapy는 웹 서버의 응답을 기다리는 시간을 제어하는 `DOWNLOAD_DELAY` 옵션을 제공합니다. 기본 값은 0.25초입니다. 너무 빠른 요청은 웹 서버에 과도한 부하를 주어 성능을 저하시킬 수 있습니다. 반면에 너무 느린 요청은 크롤링 시간을 길게 만들 수 있습니다. 적절한 값으로 대기 시간을 조정하여 웹 서버에 부하를 줄이고, 효율적인 크롤링을 할 수 있습니다.

```python
# 요청 간 대기 시간 설정 (초 단위)
DOWNLOAD_DELAY = 0.5
```

## 3. 동시 요청 수 조정하기

Scrapy에서는 동시에 처리할 수 있는 요청 수를 제어하는 `CONCURRENT_REQUESTS` 옵션을 제공합니다. 기본 값은 16입니다. 웹 서버의 처리 능력이 허용하는 범위 내에서 이 값을 늘리면, 더 많은 요청을 동시에 처리하여 크롤링 속도를 향상시킬 수 있습니다. 하지만 너무 높은 값은 웹 서버에 부하를 줄 수 있으므로 주의해야 합니다.

```python
# 동시 요청 수 설정
CONCURRENT_REQUESTS = 32
```

## 4. 캐싱 사용하기

Scrapy에서는 리소스를 로컬에 캐싱하여 중복 요청을 방지하는 기능을 제공합니다. 이를 통해 네트워크 대역폭을 절약하고 처리 시간을 단축할 수 있습니다. 캐싱을 사용하려면 `HTTPCACHE_ENABLED` 옵션을 True로 설정해야 합니다.

```python
# 캐싱 사용
HTTPCACHE_ENABLED = True
```

## 5. 헤더 설정하기

일부 웹 사이트는 헤더에 대한 제한을 둘 수 있습니다. Scrapy에서는 `DEFAULT_REQUEST_HEADERS` 옵션을 사용하여 사용자 정의 헤더를 설정할 수 있습니다. 이를 통해 웹 사이트의 크롤링 제한을 우회하거나, 필요한 헤더 정보를 추가하여 성능을 최적화할 수 있습니다.

```python
# 사용자 정의 헤더 설정
DEFAULT_REQUEST_HEADERS = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'
}
```

위의 방법들을 조합하여 Scrapy의 성능을 최적화할 수 있습니다. Scrapy는 설정 가능한 많은 옵션을 제공하므로, 각각의 사이트에 맞게 적절한 값을 선택하는 것이 중요합니다. 적절한 성능 최적화를 통해 대량의 웹 데이터를 효율적으로 수집할 수 있습니다.