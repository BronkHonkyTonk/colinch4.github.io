---
layout: post
title: "Zsh 명령어 스크립트 에러 처리"
description: " "
date: 2023-09-12
tags: [linux]
comments: true
share: true
---

Zsh은 많은 사용자가 선호하는 강력한 셸입니다. 이 셸을 사용하여 명령어 스크립트를 작성하면 보다 효율적인 작업을 수행할 수 있습니다. 하지만 때로는 스크립트 실행 중에 오류가 발생할 수 있으며, 이러한 오류를 처리하는 것은 중요한 과제입니다.

오류 처리는 스크립트의 안정성을 높이고 예외 상황에 대비할 수 있는 기능입니다. 이 글에서는 Zsh 명령어 스크립트에서의 에러 처리에 대해 알아보겠습니다.

## 1. 오류 종류 확인하기

Zsh에서는 오류가 발생할 경우 특정 오류 코드를 반환합니다. 이 오류 코드를 확인하여 오류 유형을 파악하고, 적절한 처리 방식을 선택할 수 있습니다. Zsh에서는 `$?` 변수를 통해 이 오류 코드에 접근할 수 있습니다.

예를 들어, `command_not_found` 에러는 명령어를 찾을 수 없을 때 발생합니다. 이 경우, `$?` 변수를 확인하여 `127` 값이 반환되는지 확인할 수 있습니다.

```shell
if [[ $? == 127 ]]; then
    echo "명령어를 찾을 수 없습니다."
    # 추가적인 처리 로직 구현
fi
```

## 2. `set -e`를 이용한 스크립트 종료

`set -e` 명령은 스크립트 내에서 발생하는 어떤 오류든 즉시 스크립트를 종료하는 명령입니다. 이를 사용하면 오류가 발생할 경우 추가적인 처리를 할 필요 없이 스크립트 실행을 중단할 수 있습니다.

```shell
set -e
```

위의 코드를 스크립트의 맨 위에 삽입하여 오류 발생 시 즉시 스크립트 실행을 멈출 수 있습니다. 이렇게 함으로써 오류에 대한 처리를 걱정할 필요가 없어지는데, 대신 스크립트 전체가 중단된다는 점을 고려해야 합니다.

## 3. `set +e`를 이용한 스크립트 지속 실행

`set +e` 명령은 `set -e`와 정반대입니다. 오류가 발생하더라도 스크립트를 지속적으로 실행하게 됩니다. 이런 방식은 스크립트 전체를 중단하고 싶지 않을 때 유용합니다.

```shell
set +e
```

이 명령은 오류에 대한 처리를 사용자가 직접 구현해야 한다는 점을 주의해야 합니다. 오류 여부를 확인하기 위해 `$?` 변수를 이용할 수 있습니다.

## 4. `trap`을 이용한 오류 처리

`trap` 명령은 스크립트에서 오류 발생 시 특정 동작을 수행하도록 설정할 수 있는 명령입니다. `trap`을 사용하면 스크립트 내에서 발생하는 모든 종류의 오류에 대한 처리를 설정할 수 있습니다.

```shell
trap "echo '스크립트 실행 중 오류가 발생했습니다.'" ERR
```

위의 코드를 스크립트의 맨 위에 추가하여 오류 발생 시 지정한 메시지를 출력하도록 할 수 있습니다. 이렇게 함으로써 오류에 따른 처리 로직을 구현할 수 있습니다.

## 5. 사용자 정의 오류 처리 함수 구현

Zsh 스크립트에서는 사용자 정의 함수를 구현하여 오류 처리 로직을 유연하게 구현할 수 있습니다. 예를 들어, 스크립트 종료 메시지를 출력하거나 로그 파일에 오류를 기록할 수 있습니다.

```shell
handle_error() {
    local error_code=$?
    echo "오류가 발생했습니다. 오류 코드: $error_code"
    # 추가 오류 처리 로직 구현
}

trap handle_error ERR
```

위의 코드는 `handle_error` 함수를 정의하고, 이 함수를 `trap`에 등록하여 오류 발생 시 호출되도록 합니다. 이렇게 함으로써 오류 발생 시 사용자 정의 함수를 실행하여 원하는 대로 처리할 수 있습니다.

## 6. 예외 처리하기

오류가 발생하기 전에 예외 상황을 미리 처리하는 것도 중요합니다. 예를 들어, 파일이나 디렉토리의 존재 여부를 확인하고, 존재하지 않을 경우 적절한 처리를 수행할 수 있습니다.

```shell
if [[ ! -f "example.txt" ]]; then
    echo "example.txt 파일이 존재하지 않습니다."
    # 추가 예외 처리 로직 구현
fi
```

이렇게 함으로써 예외 상황을 미리 처리해 오류가 발생하지 않도록 할 수 있습니다.

위의 내용을 참고하여 Zsh 명령어 스크립트에서의 오류 처리 방법을 적절하게 선택하고 구현해 보세요. 제대로 처리된 오류는 보다 안정적인 스크립트 실행을 가능하게 합니다.