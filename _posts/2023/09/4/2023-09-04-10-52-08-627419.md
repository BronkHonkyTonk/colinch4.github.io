---
layout: post
title: "[파이썬] 데드락과 데드락 해결 방법"
description: " "
date: 2023-09-04
tags: [python]
comments: true
share: true
---

데드락(Deadlock)은 병렬 프로그래밍에서 자주 발생하는 문제 중 하나로, 두 개 이상의 프로세스나 스레드가 서로의 작업이 끝나기를 기다리며 계속해서 진행이 멈춰있는 상태를 말합니다. 이러한 상황은 프로그램의 성능을 저하시키고 정상적인 실행을 방해할 수 있기 때문에, 데드락을 예방하고 해결하기 위한 방법이 필요합니다.

## 데드락의 조건

데드락이 발생하려면 다음과 같은 네 가지 조건이 동시에 성립해야 합니다:

1. 상호 배제(Mutual Exclusion): 한 자원은 한 번에 하나의 프로세스 또는 스레드만 사용할 수 있어야 합니다.
2. 점유와 대기(Hold and Wait): 프로세스가 이미 어떤 자원을 점유했는데 다른 자원을 기다릴 때, 점유한 자원을 다른 프로세스나 스레드에게 양보하지 않고 기다리는 상태입니다.
3. 비선점(No Preemption): 다른 프로세스나 스레드에 의해 이미 점유된 자원을 선점할 수 없어야 합니다.
4. 순환 대기(Circular Wait): 프로세스의 집합에서 각 프로세스가 다음 프로세스가 요구하는 자원을 점유하면서 대기하는 상태입니다. 이때, 마지막 프로세스는 첫 번째 프로세스가 요구하는 자원을 점유하고 대기하므로, 순환적으로 대기 상태가 형성됩니다.

## 데드락 해결 방법

데드락 해결을 위한 세 가지 주요 방법은 다음과 같습니다:

### 1. 예방(Prevention)

데드락을 예방하는 방법은 데드락이 발생하는 네 가지 조건 중 하나 이상을 제거하는 것입니다. 이를 위해 다음과 같은 방법들을 사용할 수 있습니다:

- 상호 배제 조건 해결: 자원에 접근하는 프로세스나 스레드의 수를 제한하거나, 공유 가능한 자원을 사용합니다.
- 점유와 대기 조건 해결: 프로세스가 필요한 모든 자원을 동시에 요청하도록 합니다.
- 비선점 조건 해결: 점유한 자원이 다른 프로세스나 스레드에 의해 선점될 수 있게 합니다.
- 순환 대기 조건 해결: 자원에 순서를 지정하여 원형 대기 상태를 방지합니다.

### 2. 회피(Avoidance)

회피 방법은 각 프로세스나 스레드가 요청하는 자원에 대한 정보를 미리 알고 있을 때, 데드락이 발생할 가능성이 있는 요청을 피하는 것입니다. 이를 위해 시스템은 프로세스나 스레드의 자원 요청에 대한 유형, 수량 등을 평가하여 데드락을 회피합니다. 일반적으로은 은행원 알고리즘이라고 알려진 방법을 사용하여 회피를 구현할 수 있습니다.

### 3. 탐지 및 복구(Detection and Recovery)

데드락을 탐지하고 복구하는 방법은 데드락이 발생할 가능성을 고려하여 작성된 프로그램과 알고리즘이 필요합니다. 탐지 알고리즘은 주기적으로 시스템의 상태를 모니터링하고, 데드락이 발견되면 해당 상태를 복구하기 위한 액션을 취합니다. 일반적으로 자원 할당 그래프를 사용하여 데드락을 탐지하고 해결하는 방법을 사용합니다.

## 파이썬을 이용한 데드락 예제

데드락을 시뮬레이션하기 위해 파이썬의 `threading` 모듈을 사용할 수 있습니다.

```python
import threading

# 데드락을 발생시키는 예제
def deadlock_example():
    # 락 오브젝트 생성
    lock1 = threading.Lock()
    lock2 = threading.Lock()

    # 데드락을 발생시키는 스레드 함수
    def thread1():
        lock1.acquire()
        lock2.acquire()

    def thread2():
        lock2.acquire()
        lock1.acquire()

    # 스레드 생성 및 시작
    t1 = threading.Thread(target=thread1)
    t2 = threading.Thread(target=thread2)
    t1.start()
    t2.start()

# 데드락 예제 실행
deadlock_example()
```

이는 간단한 데드락 예제로, 두 개의 스레드가 서로 다른 순서로 락을 점유하고 대기하도록 만들어져 있습니다. 이 예제를 실행하면 데드락이 발생하여 프로그램이 멈추게 됩니다. 이를 해결하기 위해서는 예방, 회피, 탐지 및 복구와 같은 방법을 사용해야 할 것입니다.