---
layout: post
title: "[파이썬] pytest 테스트 실패 재실행하기"
description: " "
date: 2023-09-07
tags: [python,pytest]
comments: true
share: true
---

## 소개

`pytest`는 파이썬에서 테스트를 작성하고 실행하는 데 사용되는 강력하고 인기있는 테스트 프레임워크입니다. 이 프레임워크를 사용하면 개발자는 테스트를 자동화하고 코드 변경 사항이 예기치 않은 오류를 일으키는지 확인할 수 있습니다.

일반적으로 `pytest`는 테스트를 성공적으로 실행하면 통과한 것으로 판단합니다. 하지만 때로는 테스트가 실패하더라도 다시 실행하여 문제가 일시적인지 확인할 필요가 있습니다. 이 글에서는 `pytest`를 사용하여 테스트 실패를 자동으로 다시 실행하는 방법에 대해 알아보겠습니다.

## 테스트 실패 재실행하기

`pytest-rerunfailures`라는 플러그인은 테스트 실패 시 해당 테스트를 지정된 횟수만큼 다시 실행합니다.

먼저, `pytest-rerunfailures`를 설치해야 합니다. 다음 명령을 사용하여 설치할 수 있습니다:

```python
pip install pytest-rerunfailures
```

설치가 완료되면 테스트를 다시 실행하고자 하는 횟수를 설정할 수 있습니다. `pytest.ini` 파일을 생성하고 다음과 같이 설정합니다:

```ini
[pytest]
reruns = 3
```

위의 예제에서는 각 테스트를 최대 3번 재실행합니다. 테스트가 성공할 경우 첫 번째 실행에서 통과한 것으로 간주됩니다.

## 예제

```python
import random

def test_random_number():
    # 임의의 숫자를 생성하여 테스트합니다
    num = random.randint(1, 10)
    
    # 홀수인지 확인하는 테스트입니다
    # 실패할 가능성이 있으므로 다시 실행합니다
    assert num % 2 == 0, f"{num} is not an even number"
```

위의 예제에서는 `test_random_number`라는 테스트 함수를 정의합니다. 이 함수는 1부터 10 사이의 임의의 숫자를 생성하고, 생성된 숫자가 짝수인지 확인합니다. 테스트가 실패하면 다시 실행되어 문제가 일시적인지 확인합니다.

## 테스트 실패 재실행하기에서 재실행 제한하기

`pytest-rerunfailures` 플러그인은 테스트를 무한히 재실행할 수 있습니다. 하지만 너무 많은 재실행은 시간 낭비일 수 있으므로 제한을 설정하는 것이 좋습니다.

복수의 테스트를 실행하는 경우 `pytest.ini` 파일에 `max_runs` 옵션을 사용하여 전체 재실행 횟수를 제한할 수 있습니다:

```ini
[pytest]
reruns = 3
max_runs = 10
```

위의 예제에서는 모든 테스트를 3번씩 재실행하고, 전체 재실행 횟수를 최대 10번으로 제한합니다. 이렇게 하면 각 테스트가 최대 3번 재실행되거나 전체적으로 10번 이하로 재실행됩니다.

## 결론

`pytest-rerunfailures` 플러그인을 사용하면 `pytest`로 실행하는 테스트가 실패할 경우 자동으로 다시 실행할 수 있습니다. 이를 통해 문제가 일시적인지 확인하고 안정성을 높일 수 있습니다. 실패 재실행 횟수를 적절히 설정하여 시간을 절약하고 원하는 결과를 얻을 수 있도록해야 합니다.

테스트를 통해 코드의 신뢰성을 개선하고 품질을 높이는 데 `pytest`를 사용하는 것은 매우 중요합니다. 테스트 실패 재실행 기능을 활용하여 더욱 강력한 테스트 시나리오를 구성해보세요!