---
layout: post
title: "[파이썬] pdb 디버거로 메모리 누수 탐지하기"
description: " "
date: 2023-09-07
tags: [pdb]
comments: true
share: true
---

메모리 누수는 소프트웨어 개발 중에 자주 발생하는 문제입니다. 메모리 누수는 사용하지 않는 메모리를 계속 차지하고 있어 시스템 성능 저하 및 예기치 않은 동작으로 이어질 수 있습니다. 이러한 문제를 해결하기 위해 디버깅 도구인 `pdb`를 사용하여 메모리 누수를 탐지하는 방법을 알아보겠습니다.

## `pdb`란?

`pdb`는 파이썬에서 제공하는 기본적인 디버깅 도구입니다. `pdb`를 사용하면 코드 실행 도중 중단점을 설정하고, 변수의 값을 확인하며, 프로그램의 흐름을 따라가며 디버깅할 수 있습니다.

## 메모리 누수를 탐지하는 방법

1. 코드에 중단점 설정하기

   메모리 누수를 탐지하기 위해서는 첫 번째 단계로 중단점을 설정해야 합니다. 중단점은 코드의 실행을 멈추고 디버깅 모드로 전환하는 지점을 말합니다.
   
   ```python
   import pdb

   def calc_sum(n):
       sum = 0
       for i in range(n):
           sum += i
       return sum

   pdb.set_trace()  # 중단점 설정

   result = calc_sum(100)
   print(result)
   ```
   
   위 예제 코드에서 `pdb.set_trace()`를 통해 코드 실행 중 멈출 수 있는 중단점을 설정하였습니다.

2. 중단점에서 `gc.collect()` 호출하기

   `gc.collect()`는 파이썬의 가비지 컬렉터를 명시적으로 호출하는 함수입니다. 가비지 컬렉터는 사용되지 않는 메모리를 회수하는 역할을 합니다.
   
   중단점에서 `gc.collect()`를 호출하여 가비지 컬렉터를 실행하고 메모리 누수를 탐지합니다.
   
   ```python
   import pdb
   import gc

   def calc_sum(n):
       sum = 0
       for i in range(n):
           sum += i
       return sum

   pdb.set_trace()  # 중단점 설정

   result = calc_sum(100)
   gc.collect()  # 가비지 컬렉터 호출
   print(result)
   ```
   
   중단점에서 `gc.collect()`를 호출하고 난 후에 메모리 사용량을 확인하여 메모리 누수 여부를 파악할 수 있습니다.

3. 디버깅 및 분석하기

   중단점에서 디버깅 모드로 전환되면 `pdb` 프롬프트가 나타납니다. 여기에서 변수의 값을 확인하거나 코드의 흐름을 따라가며 메모리 누수를 분석할 수 있습니다.
   
   ```bash
   (Pdb) print(gc.garbage)  # 가비지 컬렉터로 인해 수집된 객체들 확인
   (Pdb) continue  # 코드 실행 재개
   ```

   `pdb` 프롬프트에서 `gc.garbage`를 통해 가비지 컬렉터로 인해 수집된 객체들을 확인할 수 있습니다. 이를 통해 메모리 누수를 분석하고 수정할 수 있습니다.

## 결론

메모리 누수는 소프트웨어의 성능을 저하시키고 예기치 않은 동작으로 이어질 수 있는 심각한 문제입니다. `pdb`를 사용하여 중단점을 설정하고 가비지 컬렉터를 호출하여 메모리 누수를 탐지하고 분석할 수 있습니다. 이를 통해 안정적이고 효율적인 프로그램을 개발할 수 있습니다.