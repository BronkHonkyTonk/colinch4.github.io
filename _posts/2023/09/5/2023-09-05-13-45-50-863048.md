---
layout: post
title: "[파이썬] 파이썬 애플리케이션의 도커 컨테이너 보안 설정"
description: " "
date: 2023-09-05
tags: [python]
comments: true
share: true
---

도커(Docker)는 많은 애플리케이션 및 서비스를 컨테이너화하여 배포하고 실행하는 데 사용되는 인기 있는 플랫폼입니다. 파이썬 애플리케이션을 도커 컨테이너로 실행할 때 보안을 고려하는 것은 매우 중요합니다. 이 글에서는 파이썬 애플리케이션의 도커 컨테이너 보안 설정에 대해 알아보겠습니다.

## 1. 베이스 이미지 선택

컨테이너화된 애플리케이션을 시작할 때 가장 먼저 수행해야 할 작업은 **베이스 이미지**를 선택하는 것입니다. 베이스 이미지는 도커 컨테이너의 기본 운영 체제를 정의합니다. 베이스 이미지를 선택할 때는 신뢰할 수 있는 공식 이미지를 활용하는 것이 좋습니다. 예를 들어, `python:3.9-alpine`은 파이썬 3.9 버전을 사용하면서 초경량화된 Alpine Linux를 베이스로 사용하는 이미지입니다. Alpine Linux는 크기가 작고 보안에 신경을 많이 쓰는 운영 체제입니다.

```Dockerfile
FROM python:3.9-alpine

# 애플리케이션 종속성 설치 등 추가 설정
```

## 2. 애플리케이션 종속성 관리

파이썬 애플리케이션을 컨테이너로 배포할 때는 애플리케이션의 종속성을 관리해야 합니다. `pip`를 사용하여 `requirements.txt`에 명시된 종속성을 설치하는 것이 일반적입니다. 그러나 보안을 고려할 때는 애플리케이션의 종속성을 엄격하게 관리하는 것이 중요합니다. 이를 위해 `pip`의 버전을 고정하고, 불필요한 종속성을 제거하는 등의 작업을 수행해야 합니다. 예를 들어, `pipenv` 또는 `poetry`와 같은 도구를 사용하여 종속성 관리를 자동화할 수 있습니다.

```Dockerfile
FROM python:3.9-alpine

WORKDIR /app

COPY requirements.txt .

RUN pip install --no-cache-dir -r requirements.txt

# 애플리케이션 소스 코드 복사 등 추가 설정
```

## 3. 환경변수 보호

도커 컨테이너에는 중요한 환경변수 정보가 포함될 수 있습니다. 이러한 환경변수는 컨테이너 외부에서 접근할 수 없도록 보호되어야 합니다. 도커 컨테이너에서 환경변수를 설정할 때는 환경변수를 컨테이너 외부에서 주입하는 것이 좋습니다. 이를 통해 환경변수를 손쉽게 관리하고, 보안을 강화할 수 있습니다.

예를 들어, 다음과 같이 `docker run` 명령어를 사용하여 환경변수를 주입할 수 있습니다.

```bash
docker run -e SECRET_KEY=MY_SECRET_KEY -e DB_HOST=mydbhost myapp
```

애플리케이션에서는 환경변수를 사용할 수 있도록 파이썬의 `os.environ` 또는 `python-decouple`과 같은 패키지를 사용할 수 있습니다.

## 4. 포트 노출

파이썬 애플리케이션을 도커 컨테이너로 실행할 때는 애플리케이션이 사용하는 포트를 명시적으로 노출해야 합니다. 이를 통해 컨테이너 외부에서 애플리케이션에 접근할 수 있습니다. 그러나 포트 노출은 보안상의 이유로 신중하게 처리해야 합니다. 불필요한 포트를 개방하지 않고, 필요한 포트만 개방하는 것이 좋습니다. 또한, 컨테이너 외부와의 네트워크 통신을 암호화하는 것도 고려해야 합니다.

```Dockerfile
FROM python:3.9-alpine

# 애플리케이션 종속성 설치 등 추가 설정

EXPOSE 8000

CMD ["python", "app.py"]
```

## 5. 보안 강화

도커 컨테이너의 보안을 강화하기 위해 몇 가지 추가적인 작업을 수행할 수 있습니다. 

- 컨테이너 내부에서 불필요한 권한을 갖지 않도록 최소 권한을 부여합니다.
- 애플리케이션의 로그는 호스트 머신이 아닌 컨테이너 내부에 보관되어야 합니다.
- 컨테이너에 대한 업데이트와 패치를 정기적으로 수행하고, 신뢰할 수 있는 소스에서만 이미지를 가져와야 합니다.
- 도커 이미지를 빌드한 후에는 불필요한 캐시를 삭제하고 중요한 파일을 삭제해야 합니다.

```Dockerfile
FROM python:3.9-alpine

# 애플리케이션 종속성 설치 등 추가 설정

# 내부 권한 설정
RUN adduser -D myuser && chown -R myuser /app
USER myuser

# 로그 저장 디렉터리 설정
ENV LOG_PATH=/var/log/myapp
RUN mkdir -p $LOG_PATH && chown -R myuser $LOG_PATH

# 이미지 업데이트 및 캐시 정리
RUN apk update && rm -rf /var/cache/apk/*

CMD ["python", "app.py"]
```

위의 예시는 파이썬 애플리케이션의 도커 컨테이너 보안 설정에 대해 간단히 소개한 것입니다. 애플리케이션의 특성과 요구사항에 따라 추가 보안 설정이 필요할 수 있으며, 이를 고려하여 컨테이너를 보다 안전하고 신뢰성 있는 환경으로 운영하는 것이 중요합니다.