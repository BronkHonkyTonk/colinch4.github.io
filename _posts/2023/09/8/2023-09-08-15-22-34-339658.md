---
layout: post
title: "[파이썬] functools `functools.lru_cache()`와 메모이제이션"
description: " "
date: 2023-09-08
tags: [python,functools]
comments: true
share: true
---

메모이제이션(memoization)은 함수의 실행 결과를 저장하여 동일한 인자에 대한 계산을 다시 수행하지 않고 이미 계산한 값을 반환하는 기술입니다. 이는 실행 시간을 크게 단축시킬 수 있는데요, 파이썬에서는 `functools` 모듈의 `lru_cache()` 데코레이터를 사용하여 간단하게 메모이제이션을 구현할 수 있습니다.

## `functools.lru_cache()`의 동작 방식

`functools.lru_cache()`는 Least Recently Used (LRU) 캐시를 구현한 데코레이터입니다. 캐시는 함수의 인자를 키로 사용하여 함수의 반환 값들을 저장하고 있습니다. 여러 번 같은 인자로 함수가 호출되면, 이전에 계산된 결과를 바로 반환하여 중복된 계산을 방지합니다.

`lru_cache()`는 인자의 해시값을 이용하여 결과를 저장하며, 캐시 크기를 지정하여 메모리 사용을 제어할 수도 있습니다. 기본적으로는 가장 최근에 사용된 최대 128개의 결과만을 저장하도록 설정되어 있습니다.

## `functools.lru_cache()`의 사용 예시

다음은 `fibonacci()` 함수를 정의하고 `lru_cache()` 데코레이터를 이용하여 메모이제이션을 적용한 예시 코드입니다.

```python
import functools

@functools.lru_cache()
def fibonacci(n):
    if n < 2:
        return n
    return fibonacci(n-1) + fibonacci(n-2)
```

위의 예시에서는 `fibonacci()` 함수가 호출될 때마다 이전에 계산한 결과를 저장하고, 동일한 인자로 여러 번 호출될 경우 저장된 결과를 반환합니다. 이를 통해 대규모 계산이 필요한 경우에도 효율적으로 작동할 수 있습니다.

## 메모이제이션의 주의사항

메모이제이션은 많은 경우에 실용적이지만, 모든 함수에 적용하기에는 적합하지 않을 수도 있습니다. 다음과 같은 상황에서는 주의가 필요합니다.

1. 메모리 사용: 메모리 사용량이 큰 함수의 경우, 캐시의 크기를 적절하게 제어하지 않으면 메모리 부족으로 인한 에러가 발생할 수 있습니다.
2. 변경 가능한 인자: 함수의 인자로 변경 가능한 객체를 사용하는 경우, 해당 객체가 변경되면 캐시의 정합성이 깨질 수 있습니다. 이 경우에는 메모이제이션을 사용하지 않거나, 변경 가능한 객체를 인자로 사용하지 않는 방법을 고려해야 합니다.
3. 공유 캐시: `lru_cache()`는 기본적으로 함수마다 독립적인 캐시를 사용합니다. 따라서 여러 함수가 같은 인자로 호출될 경우, 각각 독립적인 캐시에 결과를 저장합니다. 이는 원하지 않는 결과를 초래할 수 있으므로, 캐시를 공유할 경우 주의가 필요합니다.

메모이제이션은 알고리즘 최적화와 같은 특정 상황에서 효과적일 수 있습니다. 하지만 일반적인 상황에서는 적절한 사용 방법을 고려하여야 합니다. `functools.lru_cache()`를 사용할 때에는 위의 주의사항을 유념하여 사용하시기 바랍니다.