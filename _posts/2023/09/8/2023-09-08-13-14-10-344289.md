---
layout: post
title: "[파이썬] pickle의 내부 동작 원리"
description: " "
date: 2023-09-08
tags: [python,pickle]
comments: true
share: true
---

파이썬에서 `pickle`은 객체 직렬화를 위한 강력한 도구입니다. `pickle`은 파이썬 객체를 이진 형태로 직렬화하거나, 반대로 이진 형태로 직렬화된 객체를 복원하는 기능을 제공합니다. 이를 통해 객체를 파일에 저장하거나 네트워크를 통해 전송할 수 있습니다.

## 1. 객체의 직렬화

### `pickle.dump()`

파이썬에서 `pickle.dump()` 함수를 사용하면 객체를 직렬화하여 파일에 저장할 수 있습니다. 이 함수는 다음과 같은 형태로 호출됩니다:

```python
with open('data.pickle', 'wb') as file:
    pickle.dump(obj, file)
```

위의 코드에서 `obj`는 직렬화할 객체를 나타내며, `data.pickle` 파일에 객체가 저장됩니다.

### 직렬화 과정

`pickle.dump()` 함수를 호출하면, `pickle`은 다음과 같은 과정을 거쳐 객체를 직렬화합니다:

1. 지정된 파일에 객체의 클래스 이름과 데이터가 기록됩니다.
2. 객체의 계층 구조를 따라 하위 객체들도 순서대로 기록됩니다.
3. 객체의 데이터와 내부 상태가 기록됩니다.
4. 필요한 경우, 객체에 대한 참조가 저장되고 참조된 객체들도 순서대로 직렬화됩니다.

## 2. 객체의 복원

### `pickle.load()`

반대로, `pickle.load()` 함수를 사용하면 이진 형태로 직렬화된 객체를 복원할 수 있습니다. 다음과 같은 형태로 호출됩니다:

```python
with open('data.pickle', 'rb') as file:
    obj = pickle.load(file)
```

위의 코드에서 `data.pickle` 파일에 저장된 직렬화된 객체가 `obj` 변수에 복원됩니다.

### 복원 과정

`pickle.load()` 함수를 호출하면, `pickle`은 다음과 같은 과정을 거쳐 객체를 복원합니다:

1. 이진 데이터에서 객체의 클래스 이름과 데이터를 읽어옵니다.
2. 객체의 클래스 이름을 통해 적절한 클래스를 찾습니다.
3. 찾아낸 클래스를 사용하여 새로운 객체를 생성합니다.
4. 객체의 내부 상태를 이진 데이터에서 읽어와 복원합니다.
5. 필요한 경우, 참조된 객체들도 순서대로 복원됩니다.

## 3. 주의 사항

### 보안

`pickle`은 파이썬의 안전한 실행환경인 "Sandbox"에서도 실행될 수 있기 때문에, 신뢰할 수 없는 소스에서의 `pickle` 사용은 보안상 위험을 초래할 수 있습니다. 따라서, 신뢰할 수 없는 데이터를 `pickle`을 사용하여 복원하기 전에 신중하게 검사해야 합니다.

### 호환성

`pickle`은 파이썬 버전 간의 호환성이 보장되지 않습니다. 더 낮은 버전의 파이썬으로 생성된 `pickle` 파일을 더 높은 버전의 파이썬에서 복원하는 경우, 호환성 문제가 발생할 수 있습니다. 따라서, `pickle`을 사용하여 객체를 직렬화할 때에는 호환성에 주의해야 합니다.

## 결론

`pickle`은 파이썬에서 객체 직렬화와 역직렬화를 쉽게 처리할 수 있는 강력한 도구입니다. 이를 통해 객체를 파일에 저장하거나 네트워크를 통해 전송하는 등 다양한 용도로 활용할 수 있습니다. 그러나 보안과 호환성에 대해서는 주의해야 하며, 신뢰할 수 없는 소스에서의 `pickle` 사용에는 특히 조심해야 합니다.