---
layout: post
title: "[파이썬] pickle의 보안 문제점"
description: " "
date: 2023-09-08
tags: [python,pickle]
comments: true
share: true
---

[pickle](https://docs.python.org/3/library/pickle.html)은 Python의 객체 직렬화를 위한 모듈로, 객체를 바이트 스트림으로 변환하고 다시 객체로 역직렬화하는 기능을 제공합니다. 이는 데이터를 파일에 저장하거나 네트워크를 통해 전송하는 등의 작업에서 유용하게 사용될 수 있습니다.

하지만 pickle은 **보안 문제점**을 가지고 있어 신뢰할 수 없는 소스로부터 pickle 데이터를 수신하면 치명적인 보안 위험에 노출될 수 있습니다. pickle은 실행 가능한 코드를 직렬화할 수 있기 때문에 악의적인 사용자가 피클 데이터에 악성 코드를 포함시킬 수 있습니다. 이를 통해 코드 인젝션, 원격 코드 실행 등의 공격이 가능해질 수 있습니다.

## pickle의 주요 보안 문제점

1. **악성 코드 직렬화**: pickle은 객체의 상태를 저장하기 위해 그 객체에 대한 클래스 정보, 메소드, 내부 상태 등을 직렬화합니다. 악성 사용자가 이를 이용하여 코드 인젝션을 수행할 가능성이 있습니다.

2. **원격 코드 실행**: pickle 데이터를 받아 역직렬화하는 프로세스에서 악의적인 코드 실행이 가능합니다. 만약 신뢰할 수 없는 데이터를 역직렬화하는 경우, 원격에서 임의의 코드를 실행될 수 있습니다.

## pickle 사용시 주의사항

1. 신뢰할 수 없는 소스에서 pickle 데이터를 수신하지 않는 것이 가장 좋습니다. pickle은 기본적으로 unserialize된 객체를 재생성하므로, 악성 코드를 실행할 수 있습니다.

2. `pickle.loads()` 및 `pickle.load()` 함수를 사용할 때는 반드시 신뢰할 수 있는 소스에서 데이터를 받도록 해야 합니다. 사용자 입력이나 외부에서 받아온 데이터를 pickle로 직렬화된 데이터로 처리할 경우, 악성 코드 실행에 취약해질 수 있습니다.

3. 대안으로 `json`, `xml` 등의 다른 직렬화 형식을 사용하는 것이 안전합니다. 이러한 형식들은 실행 가능한 코드를 저장하지 않으며, 보안적으로 더 안정적입니다.

```python
# pickle 사용 예시 코드
import pickle

data = {'name': 'Alice', 'age': 25}

# 데이터를 파일로 저장하는 경우
with open('data.pickle', 'wb') as f:
    pickle.dump(data, f)

# 저장된 파일을 역직렬화하여 데이터 사용하는 경우
with open('data.pickle', 'rb') as f:
    loaded_data = pickle.load(f)

print(loaded_data)  # {'name': 'Alice', 'age': 25}
```

## 결론

pickle은 편리한 객체 직렬화 기능을 제공하지만, 보안 문제점으로 인해 신뢰할 수 없는 데이터로부터 pickle을 역직렬화하는 것은 위험합니다. 사용 시에는 항상 신뢰할 수 있는 소스로부터 pickle 데이터를 받아오는 것을 권장합니다. 또한, 다른 직렬화 형식을 고려하여 객체 직렬화를 수행할 수도 있습니다.