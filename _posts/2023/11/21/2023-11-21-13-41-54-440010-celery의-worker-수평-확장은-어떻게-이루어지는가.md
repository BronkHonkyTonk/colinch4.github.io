---
layout: post
title: "[python] Celery의 worker 수평 확장은 어떻게 이루어지는가?"
description: " "
date: 2023-11-21
tags: [python]
comments: true
share: true
---

Celery는 Python 언어로 작성된 분산 작업 큐 시스템입니다. 이는 큰 규모의 작업을 처리하기 위한 강력한 도구이며, worker 수평 확장을 지원합니다.

Celery의 worker 수평 확장은 다음과 같은 방법으로 이루어집니다.

## 1. Broker 설정

Worker가 작업을 받아올 수 있는 공간으로 Broker를 설정해야 합니다. 이는 RabbitMQ, Redis, Apache Kafka 등의 메시지 브로커를 사용할 수 있습니다. Broker는 작업 메시지를 전달하고 결과를 수신하는 역할을 담당합니다.

## 2. Worker 시작

Celery worker는 `celery worker` 명령을 사용하여 시작할 수 있습니다. 이 때, `-A` 옵션을 사용하여 사용할 어플리케이션을 지정하고, `-Q` 옵션을 사용하여 작업 큐를 설정할 수 있습니다.

## 3. Worker 추가

서버의 부하를 분산시키기 위해, 더 많은 Celery worker를 추가할 수 있습니다. 각 worker는 다른 프로세스나 쓰레드에서 작동하며, Broker로부터 작업을 받아 처리합니다. 추가하는 worker의 개수는 다수의 서버에서 작업을 병렬로 처리하기 위해 조정할 수 있습니다.

새로운 worker를 추가하려면, 위와 동일한 명령을 실행하고 `-Q` 옵션을 이용하여 다른 작업 큐를 할당할 수 있습니다. 이를 통해 작업을 더욱 세분화하고 서로 다른 worker에서 동시에 실행될 수 있도록 설정할 수 있습니다.

## 4. 작업 배포

작업을 배포하기 위해서는 Celery 어플리케이션에서 작업을 정의하고, 해당 작업을 호출하면 됩니다. Celery는 작업을 Broker에게 전달하여 worker가 처리할 수 있도록 합니다.

작업을 배포하는 방법은 다양합니다. 예를 들어, Python 스크립트나 Django 애플리케이션에서 `delay()` 함수를 호출하여 작업을 바로 실행하거나, Celery Beat을 사용하여 작업을 주기적으로 실행할 수 있습니다.

## 5. 결과 확인

작업의 결과는 worker가 작업을 완료한 후에 Broker를 통해 수신할 수 있습니다. 결과는 원하는 대로 처리하거나, 필요에 따라 데이터베이스에 저장할 수도 있습니다.

## 결론

Celery를 사용하면 큰 규모의 작업을 효율적으로 처리할 수 있습니다. worker 수평 확장을 통해 시스템의 성능을 개선하고, 작업 처리 속도를 향상시킬 수 있습니다.