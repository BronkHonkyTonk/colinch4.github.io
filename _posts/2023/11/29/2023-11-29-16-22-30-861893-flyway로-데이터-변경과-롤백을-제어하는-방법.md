---
layout: post
title: "[java] Flyway로 데이터 변경과 롤백을 제어하는 방법"
description: " "
date: 2023-11-29
tags: [java]
comments: true
share: true
---

Flyway는 데이터베이스 마이그레이션 도구로서 스키마와 데이터 변경을 관리하는 데 도움을 줍니다. 이를 통해 소프트웨어 개발 및 배포 과정에서 데이터베이스 스키마 변경을 쉽고 안전하게 수행할 수 있습니다. Flyway는 자바 및 다른 여러 언어에서 사용할 수 있으며, 여기서는 Flyway를 사용하여 데이터 변경과 롤백을 제어하는 방법을 살펴보겠습니다.

## 1. Flyway 설치 및 설정

Flyway를 사용하기 위해서는 먼저 Flyway를 설치해야 합니다. Flyway는 대부분의 주요 데이터베이스 시스템과 호환됩니다. Flyway의 공식 웹사이트(https://flywaydb.org/)에서 필요한 데이터베이스와 버전에 해당하는 Flyway를 다운로드하고 설치할 수 있습니다.

설치가 완료되면 `flyway.conf`라는 파일을 생성하고, 데이터베이스 연결 정보 및 기타 설정을 정의해야 합니다. Flyway는 이 파일을 사용하여 데이터베이스 변경 및 롤백 작업에 필요한 정보를 가져옵니다.

## 2. 데이터베이스 마이그레이션 파일 작성

Flyway에서는 각 스키마 변경 작업을 단위별로 관리하기 위해 마이그레이션 파일을 사용합니다. 마이그레이션 파일은 SQL 또는 자바 스크립트 파일로 작성할 수 있으며, 순차적으로 실행됩니다.

마이그레이션 파일의 이름은 `V{버전}_{설명}.sql` 또는 `V{버전}_{설명}.java`의 형식을 따라야 합니다. 버전은 각 마이그레이션 파일의 고유한 식별자이며, 순차적으로 증가해야 합니다.

## 3. 데이터베이스 마이그레이션 실행

Flyway를 사용하여 데이터베이스 마이그레이션을 실행하려면 다음과 같은 단계를 따라야 합니다.

### 3.1. 마이그레이션 파일 위치 지정

Flyway는 기본적으로 `db/migration` 폴더에 있는 마이그레이션 파일을 찾아 실행합니다. 따라서 마이그레이션 파일을 이 폴더에 저장해야 합니다. 만약 다른 위치에 파일을 저장하려면 `flyway.locations` 옵션을 사용하여 위치를 지정할 수 있습니다.

### 3.2. 데이터베이스 연결 확인

`flyway.conf` 파일에서 설정한 데이터베이스 연결 정보를 확인하고, Flyway가 정상적으로 데이터베이스에 접속할 수 있는지 확인해야 합니다.

### 3.3. 마이그레이션 실행

실행할 마이그레이션 파일이 준비되었다면, Flyway를 실행하여 데이터베이스 마이그레이션을 수행합니다. Flyway는 데이터베이스 스키마의 현재 상태와 마이그레이션 파일의 버전을 비교하여 필요한 변경 작업을 식별하고 실행합니다.

마이그레이션 실행은 다음 명령어를 통해 수행할 수 있습니다:

```java
flyway.migrate()
```

## 4. 데이터베이스 롤백 실행

Flyway를 사용하여 마이그레이션을 롤백하려면 다음과 같은 단계를 따라야 합니다.

### 4.1. 롤백 대상 버전 확인

Flyway는 롤백하려는 마이그레이션 파일의 버전을 지정해야 합니다. 롤백하려는 대상 버전은 롤백하려는 마이그레이션 파일의 버전보다 작거나 같아야 합니다.

### 4.2. 롤백 실행

롤백 실행은 다음 명령어를 통해 수행할 수 있습니다:

```java
flyway.rollbackTo(version)
```

`version`은 롤백하려는 대상 버전을 나타냅니다.

## 마무리

Flyway를 사용하여 데이터 변경과 롤백을 제어하는 방법에 대해 알아보았습니다. Flyway는 강력하고 유연한 마이그레이션 도구로서 데이터베이스 스키마와 데이터의 변경을 쉽게 관리할 수 있게 해줍니다. Flyway의 공식 문서(https://flywaydb.org/documentation/)를 참조하여 더 자세한 기능과 사용법을 살펴보시기 바랍니다.