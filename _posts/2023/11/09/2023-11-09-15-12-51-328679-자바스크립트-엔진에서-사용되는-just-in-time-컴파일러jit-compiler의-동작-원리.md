---
layout: post
title: "자바스크립트 엔진에서 사용되는 Just-In-Time 컴파일러(JIT Compiler)의 동작 원리"
description: " "
date: 2023-11-09
tags: [자바스크립트]
comments: true
share: true
---

자바스크립트 엔진은 코드를 실행하는 데 필요한 컴파일과 실행 단계를 가지고 있습니다. 이 중에서 Just-In-Time 컴파일러(JIT Compiler)는 코드 실행 속도를 향상시키기 위해 중요한 역할을 수행합니다. JIT 컴파일러는 코드를 실행하기 전에 코드를 분석하고, 필요한 경우에만 컴파일을 수행합니다.

JIT 컴파일러의 동작 원리는 다음과 같습니다:

1. **인터프리터로 코드 실행**
   - 자바스크립트 엔진은 코드를 처음 실행할 때 인터프리터를 사용하여 코드를 한 줄씩 읽고 실행합니다.
   - 이는 빠른 실행 속도를 제공하지만, 전체 코드를 한 번에 컴파일하지 않기 때문에 최적화가 제한될 수 있습니다.

2. **프로파일링**
   - JIT 컴파일러는 코드 실행 중에 프로파일링을 수행합니다. 이는 코드의 실행 빈도, 변수 타입 등을 분석하여 최적화의 가능성을 파악하는 과정입니다.
   - 프로파일링은 일정 횟수의 코드 실행 이후에 수행되며, 거의 실행되지 않는 코드 블록이나 반복적으로 실행되는 코드 블록 등을 식별할 수 있습니다.

3. **최적화 대상 코드 식별**
   - 프로파일링 결과를 바탕으로 JIT 컴파일러는 최적화의 대상이 되는 코드 블록을 식별합니다. 이는 실행 빈도가 높은 코드나 반복 실행되는 코드 등으로 판단됩니다.
   - 최적화 대상 코드는 보통 인라인 캐싱, 인라인 확장, 타입 플로우 분석 등의 최적화 기법을 적용할 수 있습니다.

4. **인라인 캐싱과 인라인 확장**
   - JIT 컴파일러는 최적화 대상 코드에 대해 인라인 캐싱과 인라인 확장을 수행합니다.
   - 인라인 캐싱은 함수 호출 시 호출 대상 함수의 주소를 캐시하여 다음에 호출할 때 직접 접근할 수 있도록 합니다. 이는 함수 호출의 오버헤드를 줄여 실행 속도를 향상시킵니다.
   - 인라인 확장은 반복 실행되는 코드의 일부를 인라인으로 수행하도록 변경하는 최적화 기법입니다. 이는 함수 호출을 줄여 실행 속도를 향상시킵니다.

5. **컴파일 수행**
   - 최적화 대상 코드에 대해 JIT 컴파일러는 컴파일 작업을 수행합니다. 이는 인터프리터가 한 줄씩 실행하는 것보다 더 효율적인 기계어 코드로 변환하는 과정입니다.
   - 컴파일된 코드는 인터프리터로부터 전달받아 실행되며, 실행 속도가 인터프리터보다 빠르게 향상됩니다.

이렇게 JIT 컴파일러를 통해 자바스크립트 엔진은 최적화된 코드를 실행하여 실행 속도를 향상시킵니다. 하지만 프로파일링 과정에서 최적화 대상이 잘못 식별되는 경우나 최적화된 코드의 다른 부분에 영향을 주는 변경이 발생하는 경우에는 실행 속도가 저하될 수도 있습니다. 따라서 JIT 컴파일러는 정교한 프로파일링과 최적화 알고리즘을 가지고 있다고 할 수 있습니다.

참고 자료:
- [Understanding V8's Full Code Generation Pipeline](https://v8.dev/blog/ignition-and-turbo#full-code-generation-pipeline)
- [Introduction to the V8 JavaScript Engine](https://developers.google.com/v8/intro) 
- [Hidden Classes in JS V8 Engine](https://v8.dev/blog/hidden-classes) 
- [JavaScript Engines: How Do They Even Work?](https://medium.com/@_marcos_otero/javascript-engines-how-do-they-even-work-part-1-3a518280e0ab)

#JIT #컴파일러