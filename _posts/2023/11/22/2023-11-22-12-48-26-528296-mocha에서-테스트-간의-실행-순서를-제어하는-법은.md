---
layout: post
title: "[javascript] Mocha에서 테스트 간의 실행 순서를 제어하는 법은?"
description: " "
date: 2023-11-22
tags: [javascript]
comments: true
share: true
---

테스트 코드는 비동기적으로 실행될 수 있기 때문에, 테스트 간의 실행 순서가 중요할 수 있습니다. Mocha는 기본적으로 테스트들을 병렬로 실행시키지만, 때로는 테스트 간의 의존성이 있어 순차적으로 실행해야 할 수도 있습니다.

Mocha에서 테스트 간의 실행 순서를 제어하는 방법은 여러 가지가 있습니다. 아래에 몇 가지 방법을 제시하겠습니다.

## 1. 테스트 스위트 및 테스트 케이스의 순서 제어
Mocha는 `describe`와 `it` 함수를 사용하여 테스트 스위트와 테스트 케이스를 작성합니다. 이 함수들은 테스트들을 실행하는 순서를 정하는 데 사용될 수 있습니다. 예를 들어, 아래의 코드는 테스트를 직렬로 실행시킵니다.

```javascript
describe('테스트 스위트', function() {
  it('첫 번째 테스트', function() {
    // 테스트 내용
  });
  
  it('두 번째 테스트', function() {
    // 테스트 내용
  });
});
```

이 경우, 첫 번째 테스트가 완료된 후에만 두 번째 테스트가 실행됩니다.

## 2. `beforeEach`와 `afterEach` 훅 사용
Mocha에서는 테스트 실행 전/후에 실행되는 훅(hook)을 사용할 수 있습니다. 이를 활용하여 각 테스트 케이스 실행 전에 필요한 작업을 수행하거나, 각 테스트 케이스 실행 후에 정리 작업을 수행할 수 있습니다. 

아래의 예시는 `beforeEach`와 `afterEach` 훅을 사용하여 각 테스트 케이스 실행 전후에 메시지를 출력하는 방법을 보여줍니다.

```javascript
describe('테스트 스위트', function() {
  beforeEach(function() {
    console.log('테스트 실행 전');
  });
  
  afterEach(function() {
    console.log('테스트 실행 후');
  });
  
  it('첫 번째 테스트', function() {
    // 테스트 내용
  });
  
  it('두 번째 테스트', function() {
    // 테스트 내용
  });
});
```

위 코드를 실행하면, 각 테스트 케이스 실행 전에 '테스트 실행 전' 메시지가 출력되고, 실행 후에 '테스트 실행 후' 메시지가 출력됩니다.

## 3. 테스트 비동기 동작 제어
Mocha에서 비동기 테스트를 작성할 때, 테스트 케이스가 콜백 함수나 프로미스를 반환하는 경우가 많습니다. 이때 Mocha는 해당 비동기 작업이 완료될 때까지 기다린 후 다음 테스트로 넘어갑니다. 따라서 비동기 작업의 실행 순서를 제어하기 위해서는 적절한 비동기 제어 메커니즘을 사용해야 합니다. 예를 들어, 콜백 함수가 완료될 때까지 기다리는 `done` 매개변수나, 프로미스의 `then` 메소드 등을 활용할 수 있습니다.

아래는 테스트 케이스에서 `done` 매개변수를 사용하여 비동기 작업의 완료를 알리는 예시입니다.

```javascript
it('비동기 테스트', function(done) {
  // 비동기 작업
  fetchData(function() {
    // 테스트 조건 검증
    done();
  });
});
```

이 방법을 사용하면, `done()`을 호출하기 전까지 다음 테스트는 실행되지 않습니다.

Mocha에서 테스트 간의 실행 순서를 제어하는 방법은 다양하지만, 주의할 점은 테스트 간의 실행 순서를 의도적으로 변경하는 것은 항상 최소화해야 한다는 점입니다. 의존성이 있는 테스트 간의 순서 변경은 테스트의 신뢰성과 유지보수성에 문제를 일으킬 수 있으므로 신중하게 사용해야 합니다.