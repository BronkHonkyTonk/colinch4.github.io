---
layout: post
title: "[clojure] Clojure 에이전트와 락프리(lock-free) 알고리즘"
description: " "
date: 2023-12-26
tags: [clojure]
comments: true
share: true
---

Clojure는 다양한 동시성 패러다임을 지원하여 락프리 알고리즘을 통한 동시성을 구현할 수 있게 해줍니다. Clojure의 에이전트(agents)와 락프리 알고리즘을 이용하면 동시성 문제를 해결하고 데이터 불변성을 유지하는 데 매우 유용합니다.

## 에이전트란 무엇인가?

에이전트는 Clojure에서 제공하는 동시성 추상화이며, 상태(state)에 대한 변경을 추상화하기 위한 도구입니다. 에이전트를 이용하면 값을 변경할 때마다 새로운 상태를 생성하여 데이터 불변성을 유지합니다. 이를 통해 불변성을 보장하면서 여러 스레드 간에 안전하게 상태를 공유할 수 있습니다.

에이전트는 `agent` 매크로를 사용하여 생성하고 `send` 함수를 사용하여 에이전트의 상태를 변경할 수 있습니다. 에이전트는 락프리 알고리즘을 사용하므로 다수의 스레드에서 안전하게 상태를 변경할 수 있습니다.

아래는 Clojure에서 에이전트를 생성하고 상태를 변경하는 예제 코드입니다.

```clojure
(def counter (agent 0))

(send counter + 1)
```

## 락프리 알고리즘이란?

락프리 알고리즘은 동시성 환경에서 상태 변경을 위해 락(lock)을 사용하지 않고 다중 스레드가 안전하게 데이터를 업데이트할 수 있는 알고리즘을 의미합니다. 이를 통해 데드락(deadlock)이나 스레드 경합(thread contention)과 같은 문제를 피할 수 있습니다.

Clojure의 에이전트는 락프리 알고리즘을 사용하여 동시성을 구현합니다. 에이전트는 내부적으로 STM(소프트웨어 트랜잭션 메모리)과 락프리 알고리즘을 조합하여 상태 변경을 보장합니다.

## 결론

Clojure의 에이전트와 락프리 알고리즘을 이용하면 동시성 문제를 해결하고 데이터 불변성을 유지하는 데 효과적으로 사용할 수 있습니다. 에이전트를 이용하여 무거운 락(lock)을 피하고 락프리 알고리즘을 통해 안전하게 상태를 변경할 수 있습니다.

상태 변경이 필요한 경우에는 에이전트를 사용하여 변경을 보장하고 동시성을 유지할 수 있습니다.

참고 문헌:
- https://clojure.org/
- https://en.wikipedia.org/wiki/Lock-free_and_wait-free_algorithms