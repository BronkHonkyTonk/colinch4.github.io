---
layout: post
title: "[clojure] Clojure 에이전트와 메시지 전달"
description: " "
date: 2023-12-26
tags: [clojure]
comments: true
share: true
---

Clojure는 **병행 프로그래밍**을 위해 다양한 도구를 제공합니다. 그중에서도 **에이전트** 는 불변적인 상태와 비동기 메시징을 이용한 병행성 모델을 제공합니다. 이번 블로그에서는 Clojure 에이전트의 개념과 메시지 전달에 대해 살펴보겠습니다.

## 에이전트란 무엇인가요?

에이전트는 **불변적인 상태를 가진 독립적인 쓰레드**를 나타내는 Clojure의 개념입니다. 에이전트의 상태는 변경할 수 있지만, 직접적인 상태 변경이 아닌 **메시지 전달**을 통해 변경됩니다. 이를 통해 **동시성과 불변성을 유지하면서 상태를 변경**할 수 있습니다.

에이전트는 `clojure.core` 네임스페이스에 있는 `agent` 함수를 사용하여 생성할 수 있습니다.

```clojure
(def my-agent (agent {:name "John" :age 30}))
```

### 에이전트 상태 변경

에이전트의 상태는 `send`나 `send-off` 함수를 이용하여 변경됩니다. `send-off` 함수는 새로운 스레드를 생성하여 작업을 진행하고, `send` 함수는 에이전트의 관리 스레드를 이용합니다.

```clojure
(send my-agent assoc :age 31)
```

위의 코드는 `my-agent`의 상태를 변경하여 `:age`를 31로 갱신하는 메시지를 보내는 예제입니다.

### 에이전트 상태 조회

에이전트의 현재 상태는 `deref` 함수나 `@` 기호를 사용하여 조회할 수 있습니다.

```clojure
(println @my-agent)
```

## 메시지 전달

에이전트는 **메시지 큐**를 가지고 있으며, 메시지는 순차적으로 처리됩니다. 따라서 메시지 전달은 순차적으로 **동기화**된 방식으로 이루어집니다.

메시지는 에이전트가 가지고 있는 상태와 변경함수(예: `assoc`, `update`)를 함께 전달됩니다. 이 때, 변경 함수는 현재 상태와 메시지를 활용하여 새로운 상태를 계산하는 역할을 합니다.

```clojure
(send my-agent (fn [current-state] (assoc current-state :age 32)))
```

위의 코드는 `my-agent`에게 `:age`를 32로 갱신하는 함수를 전달하는 예제입니다.

## Clojure 에이전트 활용

에이전트를 사용하여 복잡한 동시성 문제를 해결할 수 있습니다. 에이전트는 **동시성 오류를 방지**하고, **불변성을 유지**하면서 공유 상태를 변경할 수 있는 강력한 도구입니다.

에이전트는 `future`, `promise`, `var` 등 다른 Clojure 도구와 함께 사용하여 병행 프로그래밍을 구현하는 데 활용됩니다.

이상으로 Clojure 에이전트와 메시지 전달에 대해 알아보았습니다. Clojure 공식 문서나 관련 자료를 참고하여 더 많은 정보를 얻을 수 있습니다.

[공식 Clojure 문서](https://clojure.org/guides/reducers_concurrency)

이제 Clojure 에이전트를 활용하여 병행 프로그래밍을 시작해보세요!