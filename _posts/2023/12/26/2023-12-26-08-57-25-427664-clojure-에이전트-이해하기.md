---
layout: post
title: "[clojure] Clojure 에이전트 이해하기"
description: " "
date: 2023-12-26
tags: [clojure]
comments: true
share: true
---

Clojure는 **병렬 처리**를 지원하기 위해 에이전트(Agent)라는 독특한 기능을 제공합니다. 에이전트는 **상태를 가지고 있는 객체**로, 상태의 변경이나 연산을 변경하기 위한 함수를 비동기적으로 처리할 수 있습니다.

## 에이전트의 생성과 사용

에이전트는 `clojure.core` 라이브러리에 정의되어 있으며, `clojure.core/agent` 함수를 사용하여 생성할 수 있습니다. 다음은 간단한 에이전트를 생성하는 예제입니다:

```clojure
(def my-agent (agent 0))
```

이제 `my-agent`에는 숫자 0이라는 상태가 저장되어 있습니다. 에이전트에 접근하여 상태를 변경하거나 연산을 수행하려면 `send`나 `send-off` 함수를 사용합니다. 

```clojure
(send my-agent + 1)
```

위의 코드는 `my-agent`의 상태에 1을 더하는 함수를 비동기적으로 실행합니다. `send`와 `send-off`의 차이점은 실행 위치에 있으며, `send`는 동일한 쓰레드에서 실행되며 `send-off`는 새로운 쓰레드에서 실행됩니다.

에이전트의 상태를 얻으려면 `deref`나 `@` 기호를 사용할 수 있습니다.

```clojure
(+ @my-agent 2)
```

에이전트에 대한 작업이 끝날 때마다 변경된 상태를 점검하고, 다음 작업이 실행될 때 변경된 상태를 사용합니다.

## 에이전트의 주의사항

에이전트를 사용할 때 주의해야 할 점이 있습니다. 에이전트는 **동시성 문제**를 해결하기 위한 것이 아니며, **데이터의 일관성을 보장**하기 위한 것이 아닙니다. 에이전트를 사용할 때에는 **부작용이 없는 함수**를 사용하는 것이 좋습니다. 또한 에이전트에 대한 작업은 **순서대로 실행**되는 것이 아니므로, **의존 관계**가 있는 경우에는 조심해야 합니다.

## 결론

Clojure 에이전트는 **동시성 처리**를 쉽게 구현할 수 있도록 도와주는 강력한 도구입니다. **병렬 처리**가 필요한 경우에는 에이전트를 활용하여 보다 안전하고 효율적인 코드를 작성할 수 있습니다.

참고 문헌: [Clojure 공식 문서](https://clojure.org/guides/using_agents)