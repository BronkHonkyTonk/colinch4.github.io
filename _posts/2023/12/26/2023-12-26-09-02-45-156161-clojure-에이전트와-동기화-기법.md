---
layout: post
title: "[clojure] Clojure 에이전트와 동기화 기법"
description: " "
date: 2023-12-26
tags: [clojure]
comments: true
share: true
---

Clojure는 **에이전트(agent)** 라는 고수준의 동시성 추상화를 제공하여 동시성 문제를 해결하는데 도움을 줍니다. 에이전트는 **상태(state)** 를 캡슐화하고, **비동기적으로(asynchronously)** 수정할 수 있도록 지원합니다.

## 에이전트의 개요

에이전트는 **가변 상태(mutable state)** 를 추상화한 것으로, 한 번에 하나의 메시지만 처리하여 순차적이고 예측 가능한 상태 변이를 보장합니다. Clojure에서는 **send** 함수를 사용하여 에이전트의 상태를 변경할 수 있습니다. 

```clojure
(def counter (agent 0))

(send counter inc)
```

위 예제에서는 `counter` 에이전트의 상태를 `inc` 함수를 이용하여 1만큼 증가시켰습니다.

## 에이전트의 동기화

에이전트는 **동기화(synchronization)**를 자동으로 처리하여 복잡한 동시성 문제를 간단하게 다룰 수 있도록 합니다. 또한 에이전트의 상태는 **병렬적(parallel)**으로 간접적인 변경이 가능하기 때문에 동일한 시간에 여러 쓰레드에서 에이전트의 상태를 수정할 수 있습니다. 하지만 Clojure에서는 에이전트가 관리하는 상태에 대한 변경이 완전히 순차적이고 비동기적으로 일어날 수 있도록 보장합니다. 에이전트는 내부적으로 메시지 큐를 사용하여 상태 변경을 처리하며, 이를 통해 상태 변경이 순차적으로 이루어짐을 보장합니다.

에이전트의 상태가 변경될 때마다 **콜백(callback)** 함수를 호출하여 상태 변경에 따른 추가적인 작업을 수행할 수 있습니다. 

## 결론

Clojure의 에이전트는 동시성 문제를 해결하려는 노력과 복잡한 동기화 기법을 간소화하여 프로그래머가 동시성에 집중하도록 도와줍니다. 하지만 에이전트 역시 과도한 사용은 성능 저하를 가져올 수 있으므로 상황에 맞는 적절한 동시성 추상화를 선택하는 것이 중요합니다.

다른 Clojure 동시성 관련 기술과 비교하여 에이전트의 특징과 장단점에 대해 더 알아보겠습니다.

### References
1. [Clojure - Agents](https://clojure.org/guides/working_with_ats)