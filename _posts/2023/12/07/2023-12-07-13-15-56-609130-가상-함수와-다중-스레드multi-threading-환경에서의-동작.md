---
layout: post
title: "[c++] 가상 함수와 다중 스레드(multi-threading) 환경에서의 동작"
description: " "
date: 2023-12-07
tags: [c++]
comments: true
share: true
---

가상 함수(virtual functions)는 C++에서 다형성(polymorphism)을 구현하기 위한 중요한 도구입니다. 동시에, 다중 스레드 환경에서의 사용에는 몇 가지 주의해야 할 점이 있습니다.

## 가상 함수의 동작

가상 함수는 파생 클래스에서 재정의(override)될 수 있는 멤버 함수로, 동적 바인딩(dynamic binding)을 통해 적절한 함수를 실행하게 됩니다. 가상 함수를 호출하는 과정에서는 가상 함수 테이블(vtable)을 사용하여 실제로 호출할 함수를 결정합니다. 이는 컴파일러가 런타임에 올바른 함수를 선택할 수 있도록 합니다.

## 다중 스레드 환경에서의 주의사항

다중 스레드 환경에서 가상 함수를 사용할 때에는 몇 가지 주의사항이 있습니다. 가장 중요한 점은 **동시에 여러 스레드에서 해당 객체를 사용하는 경우에는 그 객체의 상태가 언제나 일관적으로 유지되어야 한다**는 것입니다. 가상 함수를 호출하는 도중에 그 객체가 다른 스레드에 의해 수정될 수 있는 상황을 피해야 합니다.

이를 위해 다음과 같은 접근 방법을 고려할 수 있습니다:
1. **Locking and synchronization(잠금 및 동기화)**: 가상 함수를 호출할 때 해당 객체에 대한 접근을 잠그고, 함수 호출이 완료된 후 잠금을 푸는 방법을 사용할 수 있습니다. 이는 여러 스레드가 객체에 접근하는 것을 제어하여 데이터 일관성을 유지하는 데 도움이 됩니다.
2. **Thread-local storage(스레드 지역 저장소)**: 각 스레드가 객체의 복사본을 가지고 작업하는 방식으로, 상태가 독립적으로 유지됩니다.

## 결론

가상 함수는 C++에서 다형성을 구현하는 데 중요한 개념이지만, 다중 스레드 환경에서 사용할 때는 주의가 필요합니다. 객체의 상태 일관성을 유지하기 위해 잠금 및 동기화, 혹은 스레드 지역 저장소와 같은 방법들을 활용할 수 있습니다.

이러한 접근 방법을 통해 가상 함수를 다중 스레드 환경에서 안전하게 사용할 수 있습니다.

### References
- C++ Concurrency in Action by Anthony Williams
- C++ High Performance by Viktor Sehr and Björn Andrist