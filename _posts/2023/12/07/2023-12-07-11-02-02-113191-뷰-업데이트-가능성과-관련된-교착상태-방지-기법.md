---
layout: post
title: "[sql] 뷰 업데이트 가능성과 관련된 교착상태 방지 기법"
description: " "
date: 2023-12-07
tags: [sql]
comments: true
share: true
---

SQL에서 뷰는 테이블의 일종으로, 특정한 쿼리를 실행하여 테이블과 같은 결과를 도출하는 가상의 테이블입니다. 뷰는 편리하게 데이터를 필터링하고 사용자에게 필요한 정보를 제공하는데 사용됩니다. 하지만 때로는 뷰가 업데이트 가능성으로 인해 교착상태를 발생시킬 수 있습니다. 

교착상태란, 여러 개의 트랜잭션들이 서로의 일관성을 해치지 않으면서도 진행이 불가능한 상태를 말합니다. 이는 한 트랜잭션이 다른 트랜잭션에서 사용하는 리소스를 점유한 상태에서 우선권을 요청하는 경우에 발생할 수 있습니다. 

그렇다면 뷰 업데이트 가능성으로 인한 교착상태를 방지하기 위해 어떤 기법들이 존재하는지 알아보겠습니다.

## 1. 뷰의 사용 적정성 평가하기

뷰의 업데이트 가능성에 대한 교착상태를 방지하기 위해서는 먼저 뷰가 실제로 업데이트 되는지의 여부를 평가해야 합니다. 뷰가 자주 업데이트 되지 않거나, 업데이트 해도 교착상태가 발생할 가능성이 매우 낮다면 교착상태 방지 기법을 적용할 필요가 없을 수 있습니다.

## 2. 트랜잭션 격리 수준 설정하기

뷰 업데이트 가능성과 관련된 교착상태를 방지하기 위해 트랜잭션 격리 수준을 잘 설정해야 합니다. 격리 수준은 동시에 실행되는 트랜잭션들 사이의 일관성과 격리 수준을 제어하는 것으로, 교착상태를 예방할 수 있는 중요한 요소입니다. 

일반적으로 격리 수준을 높일수록 교착상태의 가능성을 줄일 수 있습니다. 대신, 격리 수준을 높이면 동시 처리 성능이 저하될 수 있으므로 상황에 맞게 적절한 격리 수준을 설정해야 합니다.

## 3. 뷰 업데이트 가능성이 높은 경우 트랜잭션 분리하기

뷰 업데이트 가능성이 높은 경우, 해당 뷰를 참조하는 트랜잭션을 분리하여 교착상태를 방지할 수 있습니다. 이를 위해 다음과 같은 방법을 사용할 수 있습니다.

- 테이블의 복사본을 생성하여 뷰를 업데이트하는 트랜잭션과 다른 트랜잭션을 분리합니다.
- 뷰에 대한 업데이트 작업을 단일 트랜잭션으로 처리하는 대신 여러 개의 트랜잭션으로 분할하여 동시에 실행합니다.

## 4. 뷰 업데이트 가능성이 낮은 경우 강제적으로 업데이트 방지하기

일부 뷰는 업데이트 가능성이 낮기 때문에, 이런 뷰의 업데이트를 완전히 막을 수도 있습니다. 이를 위해 다음과 같은 방법을 사용할 수 있습니다.

- 뷰의 업데이트를 금지하는 제약 조건 설정하기
- 뷰에 대한 업데이트 쿼리를 실행할 경우 오류를 발생시키는 트리거 작성하기

## 참고 자료

- [Microsoft SQL Server 공식 문서 - 교착 상태 및 뷰 업데이트에 대한 정보](https://docs.microsoft.com/ko-kr/sql/relational-databases/views/updateable-views/create-updatable-views?view=sql-server-ver15)
- [Oracle Database 공식 문서 - 뷰 업데이트 가능성 방지 기법 도입 가이드](https://docs.oracle.com/en/database/oracle/oracle-database/19/sqlrf/Managing-Viewupdatable-Views.html#GUID-3A2B85EF-0E3E-4CE4-A317-542ED942D81A)