---
layout: post
title: "[sql] 불완전한 일관성 체크로 인한 데이터 손실 사례"
description: " "
date: 2023-12-07
tags: [sql]
comments: true
share: true
---

## 소개
이번 글에서는 데이터베이스의 불완전한 일관성 체크로 인해 발생한 데이터 손실 사례를 살펴보겠습니다. 일관성은 데이터베이스의 중요한 속성 중 하나이며, 데이터의 정확성과 일관성을 유지하는 것이 매우 중요합니다. 하지만 때로는 일관성을 보장하지 못하면 데이터 손실이 발생할 수 있습니다.

## 사례 설명
어떤 회사에서는 많은 고객 데이터를 관리하는 데이터베이스 시스템을 사용하고 있었습니다. 시스템은 주문과 배송 정보를 처리하며, 이러한 정보들은 여러 테이블에 저장되었습니다. 주문 정보와 배송 정보는 각각 `orders` 테이블과 `deliveries` 테이블에 저장되었습니다.

일정한 주기로 수행되는 배송 상태 업데이트 작업 중 하나에서 일부 배송 정보가 잘못 업데이트되는 문제가 발견되었습니다. 이 작업은 배송 회사에서 제공하는 API를 통해 배송 상태를 확인하고, 그 정보를 `deliveries` 테이블에 업데이트하는 업무를 수행합니다.

그러나 어느 날 작업이 중단되고, 배송 상태를 업데이트하는 작업이 완료되지 않은 상태로 남아있었습니다. 이로 인해 주문과 배송 정보에 불일치가 발생하였고, 고객은 정확한 배송 상태를 확인하지 못하였습니다.

문제 원인은 일부 배송 상태 업데이트 작업이 예외 상황에서 실패하여 트랜잭션이 롤백되지 않았고, 이로 인해 `deliveries` 테이블에서 업데이트 되어야 할 데이터가 실제로는 업데이트되지 않은 상태로 남아있었습니다.

## 문제 해결 방안
이러한 불완전한 일관성 체크로 인한 데이터 손실과 같은 문제를 방지하기 위해서는 데이터베이스 트랜잭션의 ACID 원칙을 엄격히 준수해야 합니다. 다음과 같은 방안을 고려해볼 수 있습니다.

- 트랜잭션 롤백: 작업 중 예외가 발생하더라도 트랜잭션을 롤백하여 이전 상태로 되돌립니다.
- 강력한 병행 제어: 동시에 실행되는 작업들이 데이터를 일관되게 처리할 수 있도록 병행 제어를 강화합니다.
- 데이터 유효성 검사: 데이터를 업데이트하기 전에 필요한 유효성 검사를 수행하여 데이터 무결성을 보장합니다.

## 결론
데이터의 일관성은 데이터베이스 시스템의 가장 중요한 속성 중 하나입니다. 불완전한 일관성 체크로 인해 발생하는 데이터 손실은 심각한 문제로 이어질 수 있습니다. 따라서 데이터베이스 시스템을 설계하고 운영할 때에는 일관성 유지에 대한 신중한 고려가 필요합니다.