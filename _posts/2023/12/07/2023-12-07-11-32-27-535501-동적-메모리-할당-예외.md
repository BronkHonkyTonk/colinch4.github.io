---
layout: post
title: "[swift] 동적 메모리 할당 예외"
description: " "
date: 2023-12-07
tags: [swift]
comments: true
share: true
---

애플리케이션 개발시에 가끔씩 동적 메모리 할당이 필요할 때가 있습니다. 동적 메모리 할당은 코드 실행 중에 필요한 메모리 공간을 동적으로 할당하는 것을 의미합니다. 이를 통해 배열, 구조체 및 개체 등의 데이터 구조를 생성하고, 가변 크기의 데이터를 처리할 수 있습니다. 그러나, 동적 메모리 할당은 잘못 사용할 경우 예외를 발생시킬 수 있습니다. 이번 글에서는 Swift에서 동적 메모리 할당 예외에 대해 알아보겠습니다.

## 메모리 할당과 해제

Swift에서 동적 메모리 할당을 위해 `malloc()`과 `free()` 함수를 사용할 수 있습니다. `malloc()` 함수는 필요한 바이트 크기의 메모리 블록을 할당하고, `free()` 함수는 할당된 메모리를 해제합니다. 아래는 `malloc()`과 `free()`의 예시 코드입니다.

```swift
var num = 10
let ptr = malloc(num * MemoryLayout<Int>.size)
// 필요한 바이트 크기만큼 메모리 블록 할당

if let intPtr = ptr?.bindMemory(to: Int.self, capacity: num) {
    for i in 0..<num {
        intPtr[i] = i
    }
    // 할당된 메모리에 값을 저장할 수 있음
}

free(ptr)
// 할당된 메모리 해제
```

위의 코드에서는 10개의 `Int` 타입 변수를 저장할 수 있는 메모리 블록을 할당하고, 값들을 저장한 뒤, 해제하는 과정을 보여주고 있습니다.

## 예외 발생

동적 메모리 할당을 관리하는 과정에서 발생할 수 있는 예외는 크게 두 가지입니다.

1. 메모리 누수: 할당한 메모리를 해제하지 않고 유지하는 경우 메모리 누수가 발생합니다. 이는 메모리 부족이나 더 이상 할당할 수 없는 상황을 초래할 수 있습니다. 메모리 누수를 방지하기 위해서는 할당한 메모리를 반드시 해제해야 합니다.

2. 메모리 오버플로우: 할당된 메모리 영역을 벗어나서 데이터를 저장하는 경우 메모리 오버플로우가 발생합니다. 이로 인해 다른 데이터를 덮어쓰거나 애플리케이션의 비정상적인 종료를 초래할 수 있습니다. 이를 방지하기 위해서는 할당한 메모리 영역 내에서만 데이터를 저장해야 합니다.

위에서 소개한 예시 코드는 메모리 해제를 하는 부분이 있지만, 사용자가 실수로 메모리를 해제하지 않는 경우 메모리 누수가 발생할 수 있습니다. 또한 할당된 메모리 크기를 초과해서 값을 저장하려는 경우에는 메모리 오버플로우가 발생할 수 있습니다.

## 예외 처리

동적 메모리 할당 예외를 방지하고 처리하는 가장 좋은 방법은 Swift의 안전한 메모리 관리 기능을 활용하는 것입니다. Swift에서는 `Array` 및 `Dictionary` 같은 자료형을 사용하여 메모리를 동적으로 할당하고, 자동으로 메모리를 관리할 수 있습니다. 이를 통해 메모리 누수와 메모리 오버플로우 같은 예외를 최소화할 수 있습니다.

```swift
var arr = [Int]()
// 비어 있는 정수 배열 생성

for i in 0..<10 {
    arr.append(i)
}
// 배열에 값을 추가할 수 있음

print(arr)
// [0, 1, 2, 3, 4, 5, 6, 7, 8, 9]
```

위의 코드에서는 `Array`를 사용하여 간편하게 메모리를 동적으로 할당하고, 값을 추가하는 예시를 보여주고 있습니다.

## 결론

Swift에서 동적 메모리 할당 예외를 예방하고 처리하기 위해서는 메모리 누수와 메모리 오버플로우를 방지해야 합니다. 이를 위해 Swift에서 제공하는 안전한 메모리 관리 기능을 활용하는 것이 좋습니다. 적절한 예외 처리를 통해 안정적이고 안전한 애플리케이션을 개발할 수 있습니다.

## 참고 자료

- [Swift Documentation](https://docs.swift.org/swift-book/LanguageGuide/AutomaticReferenceCounting.html)
- [Apple Developer Documentation](https://developer.apple.com/documentation/swift/memory_management)