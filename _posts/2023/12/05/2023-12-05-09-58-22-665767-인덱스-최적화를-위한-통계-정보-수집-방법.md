---
layout: post
title: "[sql] 인덱스 최적화를 위한 통계 정보 수집 방법"
description: " "
date: 2023-12-05
tags: [sql]
comments: true
share: true
---

## 개요
인덱스는 데이터베이스의 성능을 향상시키기 위해 중요한 역할을 합니다. 하지만 인덱스를 최적화하기 위해서는 정확한 통계 정보가 필요합니다. 이번 포스트에서는 통계 정보를 수집하는 방법을 알아보겠습니다.

## 통계 정보란?
통계 정보는 테이블의 데이터 분포 및 칼럼의 고유값 개수, 특정 범위 등의 정보를 의미합니다. 이러한 통계 정보는 옵티마이저가 쿼리 실행 계획을 수립할 때 사용되며, 쿼리 최적화에 중요한 역할을 합니다.

## 통계 정보 수집 방법
### 1. 자동 통계 정보 수집
대부분의 데이터베이스 시스템은 자동으로 통계 정보를 수집합니다. 일정 주기로 테이블의 데이터 분포를 분석하여 통계 정보를 생성하고 업데이트합니다. 이 경우에는 별도로 설정할 필요가 없으며, 데이터베이스 시스템이 자동으로 처리합니다.

### 2. 수동 통계 정보 수집
자동 통계 정보 수집이 제대로 이루어지지 않거나 필요한 경우에는 수동으로 통계 정보를 수집할 수 있습니다. 다음은 몇 가지 대표적인 방법입니다.

#### 2.1. ANALYZE 문 사용
데이터베이스 시스템에서 제공하는 `ANALYZE` 문을 사용하여 통계 정보를 수집할 수 있습니다. 예를 들어, MySQL에서는 `ANALYZE TABLE` 명령을 사용하여 테이블의 통계 정보를 갱신할 수 있습니다.

```sql
ANALYZE TABLE 테이블이름;
```

#### 2.2. DBMS 통계 정보 수집 도구 사용
대부분의 데이터베이스 시스템은 통계 정보 수집을 위한 도구를 제공합니다. 이 도구를 사용하여 테이블이나 인덱스의 통계 정보를 수집할 수 있습니다. 예를 들어, Oracle에서는 `DBMS_STATS` 패키지를 사용하여 통계 정보를 수집할 수 있습니다.

```sql
BEGIN
  DBMS_STATS.GATHER_TABLE_STATS(
    ownname      => '스키마명',
    tabname      => '테이블이름',
    method_opt   => 'FOR ALL COLUMNS SIZE AUTO'
  );
END;
```

## 결론
인덱스의 성능을 향상시키기 위해서는 정확한 통계 정보가 필요합니다. 자동으로 통계 정보를 수집하는 데이터베이스 시스템을 사용하는 것이 가장 일반적이지만, 필요한 경우에는 수동으로 통계 정보를 수집할 수도 있습니다. 생산 환경에서는 통계 정보를 주기적으로 업데이트하여 쿼리 최적화에 필요한 정보를 제공하는 것이 좋습니다.

## 참고 자료
- [MySQL :: MySQL 5.7 Reference Manual :: 14.14.3 InnoDB and ANALYZE TABLE](https://dev.mysql.com/doc/refman/5.7/en/innodb-analyze-table-best-practices.html)
- [Oracle :: DBMS_STATS](https://docs.oracle.com/cd/B19306_01/appdev.102/b14258/d_stats.htm)