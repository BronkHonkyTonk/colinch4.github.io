---
layout: post
title: "[sql] 프로시저 호출 시 복제/이중화 처리 방법"
description: " "
date: 2023-12-05
tags: [sql]
comments: true
share: true
---

SQL 프로시저는 데이터베이스에서 여러 개의 작업을 묶어 하나의 실행 단위로 처리할 수 있도록 해주는 기능입니다. 프로시저를 호출하는 경우, 데이터의 안정성과 가용성을 보장하기 위해 복제와 이중화 처리를 고려해야 합니다.

## 데이터베이스 복제

데이터베이스 복제는 데이터의 복사본을 여러 개의 서버에 분산하여 저장하는 방법입니다. 이를 통해 데이터 손실이나 서버 장애 발생 시에도 데이터를 복구하거나 서비스를 중단하지 않고 계속할 수 있습니다. 

1. 마스터-슬레이브 복제(Master-Slave Replication): 마스터 데이터베이스에서 변경된 데이터를 슬레이브 데이터베이스에 복제하는 방식입니다. 프로시저 호출 시에는 마스터 데이터베이스에만 호출하고, 슬레이브 데이터베이스는 읽기 작업에 사용합니다.

2. 마스터-마스터 복제(Master-Master Replication): 여러 개의 마스터 데이터베이스간에 서로 동기화하여 데이터를 복제하는 방식입니다. 프로시저 호출 시 어느 마스터 데이터베이스를 선택해 호출해도 됩니다. 다만, 데이터 충돌을 방지하기 위해 충돌 검사 로직을 구현해야 합니다.

## 데이터베이스 이중화

데이터베이스 이중화는 데이터베이스 서버를 여러 대 운영하여 한 서버가 장애 발생 시에도 다른 서버로 서비스를 유지할 수 있도록 하는 방법입니다. 프로시저 호출 시에는 이중화된 서버 중 하나를 선택하여 호출할 수 있습니다.

1. 액티브-패시브 방식: 메인 서버(액티브 서버)와 백업 서버(패시브 서버)로 이루어진 방식입니다. 액티브 서버에 장애가 발생하면 패시브 서버가 자동으로 대체하여 서비스를 유지합니다.

2. 액티브-액티브 방식: 여러 개의 서버가 모두 액티브 상태로 운영되며, 트래픽을 분산시킴으로써 서비스의 가용성을 높입니다. 프로시저 호출 시에는 어느 서버를 선택해 호출하더라도 동일한 작업이 수행됩니다.

## 주의사항

- 복제와 이중화를 구성하기 위해 추가적인 하드웨어나 인프라 구성이 필요할 수 있습니다.
- 데이터 일관성 및 동기화 문제가 발생할 수 있으므로, 잘못된 사용이나 구성 설정은 심각한 문제를 야기할 수 있습니다.
- 데이터베이스 엔진의 기능과 설정에 따라 구현 방법이 달라질 수 있습니다.

## 결론

프로시저 호출 시에 복제와 이중화를 고려하여 데이터의 안정성과 가용성을 보장할 수 있습니다. 데이터베이스 복제는 데이터의 복사본을 분산 저장하여 데이터 손실을 방지하고, 데이터베이스 이중화는 다중 서버 구성으로 장애 시에도 서비스를 유지할 수 있게 합니다. 적합한 방식을 선택하고 구성하는 것이 중요하며, 주의사항을 고려하여 신중하게 구현해야 합니다.

> 참고:  
> - [마스터-슬레이브 복제](https://dev.mysql.com/doc/refman/5.7/en/replication-solutions.html)  
> - [마스터-마스터 복제](https://dev.mysql.com/doc/refman/5.7/en/replication-solutions.html)  
> - [액티브-패시브 복제](https://aws.amazon.com/rds/aurora/details/multi-master/)  
> - [액티브-액티브 복제](https://blogs.oracle.com/mysql/active-active-replication)