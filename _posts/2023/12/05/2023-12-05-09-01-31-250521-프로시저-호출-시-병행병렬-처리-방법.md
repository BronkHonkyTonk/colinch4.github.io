---
layout: post
title: "[sql] 프로시저 호출 시 병행/병렬 처리 방법"
description: " "
date: 2023-12-05
tags: [sql]
comments: true
share: true
---

SQL 프로시저를 호출할 때, 병행 또는 병렬 처리를 수행하는 방법은 여러 가지가 있습니다. 이러한 처리 방식을 통해 성능을 향상시킬 수 있고, 시스템 자원을 효율적으로 활용할 수 있습니다. 이 글에서는 몇 가지 주요한 방법과 그 기능을 살펴보겠습니다.

## 1. 병행 처리 방법

### 1.1. 클라이언트 병행 처리

클라이언트에서 여러 개의 독립적인 연결을 생성하고, 각 연결을 이용하여 병행 작업을 수행할 수 있습니다. 여러 클라이언트가 동시에 프로시저를 호출하고 병행으로 실행되도록 하는 방식입니다. 

```sql
-- 클라이언트 1
CALL my_procedure();

-- 클라이언트 2
CALL my_procedure();
```

이 방법은 다수의 클라이언트가 프로시저를 호출하여 병행으로 실행할 수 있어, 처리 속도를 향상시킬 수 있습니다. 단, 각 클라이언트 간의 동기화 및 데이터 일관성 유지에 주의해야 합니다.

### 1.2. 동시성 제어

동시성 제어 기법을 사용하여 여러 클라이언트가 동시에 프로시저를 호출하더라도 충돌이 발생하지 않도록 할 수 있습니다. 대표적인 동시성 제어 기법에는 Locking, Transaction Isolation Level, MVCC(Multi-Version Concurrency Control) 등이 있습니다.

Locking: 프로시저 수행 중에 사용되는 데이터나 리소스에 대해 Lock을 걸어 다른 클라이언트의 접근을 제한하는 방법입니다. 다만, Lock으로 인한 대기 시간이 발생할 수 있으므로 주의가 필요합니다.

Transaction Isolation Level: 트랜잭션 격리 수준을 설정하여 다른 클라이언트의 변경 작업이나 프로시저 호출에 대한 영향을 최소화합니다.

MVCC: 데이터의 버전 관리를 통해 여러 클라이언트가 동시에 데이터를 읽거나 수정할 수 있도록 합니다. 이를 통해 Locking에 의한 대기 시간을 최소화할 수 있습니다.

## 2. 병렬 처리 방법

### 2.1. 병렬 실행 계획 생성

실행 계획을 생성할 때, 병렬 실행을 위한 옵션을 설정하여 프로시저 호출을 병렬로 처리할 수 있습니다. 이를 통해 여러 개의 쓰레드 또는 프로세스를 사용하여 동시에 프로시저를 실행할 수 있습니다.

```sql
-- 병렬 실행 계획 힌트 사용
SELECT /*+ parallel(my_procedure, 4) */ * FROM my_table;
```

위의 예시에서는 `parallel` 힌트를 사용하여 `my_procedure` 프로시저를 병렬로 처리하도록 지정하였습니다. `4`는 병렬 실행에 사용되는 쓰레드 또는 프로세스의 개수입니다.

### 2.2. 병렬 실행 제어

DBMS의 설정을 통해 병렬 실행에 대한 제어를 할 수 있습니다. 병렬 실행에 영향을 미치는 주요한 설정 항목은 아래와 같습니다.

- `parallel_max_servers`: 병렬로 실행할 최대 서버 개수를 설정합니다.
- `parallel_min_time_threshold`: 병렬로 실행할 작업에 대한 최소 실행 시간을 설정합니다.

이러한 설정을 통해 시스템 자원을 효율적으로 활용하고, 병렬 실행을 통해 성능을 향상시킬 수 있습니다.

## 결론

프로시저 호출 시 병행 또는 병렬 처리를 수행하는 방법을 살펴보았습니다. 병행 처리를 통해 여러 클라이언트가 동시에 프로시저를 호출하고 병렬로 실행할 수 있으며, 병렬 처리를 통해 병렬 실행 계획 생성이나 DBMS 설정을 통해 성능을 향상시킬 수 있습니다. 적절한 방법을 선택하여 시스템 자원을 효율적으로 활용하고 빠른 응답 시간을 제공할 수 있도록 하는 것이 중요합니다.

**참고 자료:**
- Oracle Database Concepts Guide: https://docs.oracle.com/cd/E11882_01/server.112/e40540/process.htm#CNCPT88890
- Microsoft SQL Server Parallel Query: https://docs.microsoft.com/en-us/sql/t-sql/queries/hints-transact-sql-query?view=sql-server-ver15#parallel