---
layout: post
title: "[swift] 스레드의 데드락(deadlock) 문제와 해결 방법"
description: " "
date: 2023-12-05
tags: [swift]
comments: true
share: true
---

스레드 프로그래밍은 병렬 처리를 가능하게 해주는 강력한 툴입니다. 그러나 스레드를 사용하다 보면 데드락(deadlock)이라는 문제가 발생할 수 있습니다. 데드락은 스레드가 서로를 기다리면서 무한히 멈춰버리는 상황을 말합니다. 이 문제를 해결하는 방법을 알아보겠습니다.

## 데드락이 발생하는 상황

데드락은 일반적으로 다음과 같은 상황에서 발생합니다:

1. 상호 배제(Mutual Exclusion): 자원은 한 번에 하나의 스레드만 사용할 수 있어야 합니다.
2. 점유와 대기(Hold and Wait): 스레드가 자원을 점유한 상태에서 다른 자원을 대기하고 있습니다.
3. 비선점(No Preemption): 한 스레드가 사용 중인 자원을 강제로 빼앗아 사용할 수 없습니다.
4. 순환 대기(Circular Wait): 다수의 스레드가 순환적으로 자원을 대기하고 있습니다.

이러한 상황이 동시에 발생하면 데드락이 발생하게 됩니다. 예를 들어, 스레드 A는 자원 X를 점유하고 있으며, 스레드 B는 자원 Y를 점유하고 있습니다. 하지만 A는 Y를, B는 X를 대기하고 있기 때문에 서로 상대방이 자원을 반납할 때까지 멈춰있으며, 이는 무한 반복될 수 있습니다.

## 데드락 해결 방법

데드락을 해결하기 위한 여러 가지 방법이 있습니다. 이 중에서 주요한 방법을 간단히 설명하겠습니다.

### 상호 배제(Mutual Exclusion) 방지

자원에 대한 상호 배제를 제거하면 데드락 문제를 해결할 수 있습니다. 하지만 이는 현실적으로 어려울 수 있습니다. 왜냐하면 상호 배제는 다중 스레드 환경에서의 원자성 보장을 위해 필요한 개념이기 때문입니다. 상호 배제를 완전히 제거하면 경쟁 상태(Race Condition)와 같은 심각한 문제가 발생할 수 있습니다.

### 점유와 대기(Hold and Wait) 방지

점유와 대기를 방지하기 위해, 자원을 얻기 위해서는 점유하고 있는 다른 자원을 모두 반납해야 합니다. 이를 위해 자원 요청 시에 다른 자원을 점유하고 있을 경우, 그 자원을 반납하고 다음에 다시 요청하는 방식으로 구현할 수 있습니다.

### 비선점(No Preemption) 방지

비선점을 방지하기 위해, 스레드가 이미 점유한 자원을 강제로 반납하고 다른 스레드에게 양보할 수 있도록 만들어야 합니다. 이를 위해서는 자원의 우선순위를 정의하고, 해당 우선순위가 높은 자원을 점유한 스레드에 의해 낮은 우선순위의 자원이 반납되도록 구현해야 합니다.

### 순환 대기(Circular Wait) 방지

순환 대기를 방지하기 위해서는 자원에 고유한 ID를 할당하고, 자원 요청 시에는 오름차순으로 자원 ID를 요청하도록 만들어야 합니다. 이를 통해 순환 대기를 예방할 수 있습니다.

## 결론

스레드의 데드락 문제는 병렬 처리 환경에서 자주 발생하는 문제입니다. 이러한 문제를 해결하기 위해서는 상호 배제, 점유와 대기, 비선점, 순환 대기를 방지하는 방법을 사용할 수 있습니다. 이를 통해 안정적이고 효율적인 스레드 프로그래밍을 구현할 수 있습니다.

## 참고 자료

- [Concurrency: Deadlock and Starvation](https://docs.oracle.com/javase/tutorial/essential/concurrency/deadlock.html)
- [Deadlock Prevention](https://www.tutorialspoint.com/deadlock-prevention)
- [Deadlock - Wikipedia](https://en.wikipedia.org/wiki/Deadlock)