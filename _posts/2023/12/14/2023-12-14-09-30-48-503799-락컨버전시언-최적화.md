---
layout: post
title: "[c++] 락컨버전시언 최적화"
description: " "
date: 2023-12-14
tags: [c++]
comments: true
share: true
---

C++에서 락 컨버전시언은 다중 스레드 환경에서 경합 조건을 피하기 위해 사용되는 기술입니다. 락 컨버전시언 최적화는 락을 사용하는 방식을 최적화하고 성능을 향상시키는 것을 말합니다. 이 기술은 다중 스레드 환경에서 안정성을 유지하면서 동시성을 개선하는 데 도움이 됩니다.

## 1. 락 컨버전시언 최적화란?

락 컨버전시언 최적화는 다중 스레드 환경에서 락을 효율적으로 사용하는 것을 의미합니다. 이를 통해 경합 조건을 줄이고 성능을 향상시킬 수 있습니다. 락 컨버전시언을 최적화하려면 락을 가능한 짧은 시간 동안 보유하고, 락을 여러번 사용하는 것을 피해야 합니다.

## 2. 락 컨버전시언 최적화하는 방법

### 2.1. 락 범위 최소화

가능한 한 락을 잠금하는 범위를 최소화해야 합니다. 필요한 부분만 락으로 보호하여 다른 스레드가 락을 기다리는 시간을 최소화할 수 있습니다. 

```c++
std::unique_lock<std::mutex> lock(mutex, std::defer_lock);
// ... 락을 잠그는 부분
lock.lock();
// ... 보호가 필요한 작업 수행
lock.unlock();
// ... 락 해제
```

### 2.2. 락 피하기

불필요한 락 사용을 피하고, 원자적인 연산을 사용하여 경합 조건을 제거합니다.

```c++
std::atomic<int> counter(0);
// ...
counter.fetch_add(1);
```

### 2.3. 로컬 변수 사용

로컬 변수를 사용하여 스레드 간의 경합 조건을 줄일 수 있습니다.

```c++
void func()
{
    int local_var = shared_var;
    // ... local_var를 사용하여 작업 수행
}
```

## 3. 락 컨버전시언 최적화의 장단점

### 3.1. 장점

- 다중 스레드 환경에서 경합 조건을 줄여 성능을 향상시킬 수 있습니다.
- 락을 최소화하여 동시성을 개선하고 데드락 가능성을 줄일 수 있습니다.

### 3.2. 단점

- 잘못 사용할 경우 프로그램의 안정성을 저해할 수 있습니다.
- 최적화를 위해 코드가 복잡해질 수 있습니다.

## 4. 결론

락 컨버전시언 최적화는 다중 스레드 환경에서 성능을 향상시키고 락을 효율적으로 사용하는 데 도움이 됩니다. 그러나 올바르게 사용해야 하며, 코드의 복잡성과 안정성에 신중하게 대해야 합니다.

## 참고 자료
- C++ Concurrency in Action, by Anthony Williams
- C++ High Performance, by Björn Andrist