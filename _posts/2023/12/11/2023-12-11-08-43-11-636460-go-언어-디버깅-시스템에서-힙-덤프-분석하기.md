---
layout: post
title: "[go] Go 언어 디버깅 시스템에서 힙 덤프 분석하기"
description: " "
date: 2023-12-11
tags: [go]
comments: true
share: true
---

Go 프로그램을 디버깅하다 보면 메모리 누수나 성능 문제 등의 이유로 **힙 덤프**(heap dump)를 분석해야 하는 경우가 있습니다. **힙 덤프**는 프로그램 실행 중에 할당된 메모리 상태를 스냅샷으로 찍어서 저장하는 것을 말합니다. 이번 포스트에서는 Go 언어의 디버깅 시스템에서 힙 덤프를 어떻게 분석하는지 알아보겠습니다.

## 힙 덤프 얻기

Go 언어는 힙 덤프를 생성하는 기능을 내장하고 있습니다. 실행 중인 프로세스에 특정 시그널을 전송하여 힙 덤프를 트리거할 수 있습니다. 일반적으로 `SIGQUIT` 시그널을 사용하여 힙 덤프를 생성합니다. 

```go
kill -SIGQUIT <pid>
```

위 명령어를 통해 실행 중인 Go 프로세스에 `SIGQUIT` 시그널을 보내면 힙 덤프 파일이 생성됩니다.

## 힙 덤프 분석 도구

힙 덤프 파일을 분석하기 위해서는 다양한 도구들을 사용할 수 있습니다. Go 언어의 힙 덤프는 일반적으로 pprof(pprof)를 사용하여 분석합니다. pprof는 분석에 필요한 각종 통계 정보를 제공하여 메모리 누수나 성능 문제를 분석하는 데 도움이 됩니다.

## pprof를 사용한 힙 덤프 분석

pprof를 사용하여 힙 덤프를 분석하는 방법은 매우 간단합니다. 먼저, 힙 덤프를 생성한 후 아래 명령어를 통해 pprof 웹 인터페이스를 실행합니다.

```bash
go tool pprof <힙 덤프 파일> 
```

웹 인터페이스가 실행되면 `top` 명령어를 통해 가장 많은 메모리를 사용하는 함수들을 확인할 수 있습니다. `list` 명령어를 사용하면 특정 함수의 소스 코드와 라인별 메모리 사용량을 확인할 수 있습니다.

## 결론

Go 언어의 내장 디버깅 시스템을 사용하여 힙 덤프를 분석하는 방법을 살펴보았습니다. 힙 덤프 분석을 통해 메모리 누수 및 성능 문제를 신속하게 해결할 수 있으며, pprof와 같은 도구를 통해 효율적으로 분석할 수 있습니다.

참고문헌:

- https://golang.org/pkg/runtime/debug/#SetGCPercent
- https://www.ardanlabs.com/blog/2013/10/debugging-performance-issues-in-go.html