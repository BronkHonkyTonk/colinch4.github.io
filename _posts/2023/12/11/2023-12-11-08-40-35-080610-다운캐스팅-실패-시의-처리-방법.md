---
layout: post
title: "[swift] 다운캐스팅 실패 시의 처리 방법"
description: " "
date: 2023-12-11
tags: [swift]
comments: true
share: true
---

다운캐스팅이란 슈퍼클래스의 인스턴스를 서브클래스의 인스턴스로 캐스팅하는 것을 의미합니다. 스위프트에서는 다운캐스팅 시에 옵셔널 타입으로 반환되며, 이때 다운캐스팅이 실패할 수 있습니다. 다운캐스팅이 실패한 경우에 대비하여 효과적으로 처리하기 위한 방법에 대해 알아보겠습니다.

## 다운캐스팅 실패 확인하기

다운캐스팅을 시도할 때, 다운캐스팅이 성공하면 옵셔널 값이 반환되고, 실패하면 `nil` 값이 반환됩니다. 이를 통해 다운캐스팅이 성공했는지 여부를 확인할 수 있습니다.

다음은 `as?` 연산자를 사용하여 다운캐스팅을 시도하고, 그 결과를 확인하는 예제 코드입니다.

```swift
class Animal {
    func makeSound() {
        print("Some sound")
    }
}

class Dog: Animal {
    func bark() {
        print("Woof!")
    }
}

let animal = Animal()
let dog = Dog()

if let dog = animal as? Dog {
    dog.bark()
} else {
    print("다운캐스팅 실패")
}
```

위 예제에서 `animal` 인스턴스를 `Dog`로 다운캐스팅하여 성공한 경우 `bark()` 메서드를 호출하고, 실패한 경우 "다운캐스팅 실패"를 출력합니다.

## 다운캐스팅 실패 시 처리 방법

다운캐스팅이 실패한 경우에는 다양한 방법으로 처리할 수 있습니다. 주로 다운캐스팅이 실패했을 때의 기본 동작을 정의하는 방법과 같이 결과에 따라 다르게 처리하는 방법이 있습니다.

### 기본 동작 정의

가장 일반적인 방법은 `if let` 또는 `guard let`을 사용하여 옵셔널 값을 바인딩한 후, 다운캐스팅이 성공한 경우와 실패한 경우에 대해 각각의 동작을 정의하는 것입니다.

```swift
if let dog = animal as? Dog {
    dog.bark()
} else {
    print("다운캐스팅 실패")
    // 다운캐스팅 실패 시 처리할 작업
}
```

### 강제 언래핑과 오류 처리

때로는 다운캐스팅이 실패하면 프로그램의 동작을 중지시키는 것이 적절한 경우도 있습니다. 이때는 강제 언래핑 또는 오류 처리를 통해 실패 시에 프로그램이 중지되도록 할 수 있습니다.

```swift
let dog = animal as! Dog // 다운캐스팅 실패 시 런타임 오류 발생

do {
    let dog = try animal as Dog // 다운캐스팅 실패 시 오류 throw
    dog.bark()
} catch {
    print("다운캐스팅 실패")
    // 다운캐스팅 실패 시 처리할 작업
}
```

### 기본값 사용

다운캐스팅이 실패한 경우 기본값을 사용하거나 특정 동작을 수행하도록 설정할 수도 있습니다.

```swift
if let dog = animal as? Dog {
    dog.bark()
} else {
    print("다운캐스팅 실패, 기본 동작 수행")
    // 다운캐스팅 실패 시 기본 동작 수행
}
```

위와 같이, 다운캐스팅이 실패한 경우에 대비하여 적절한 처리를 함으로써 안전한 프로그래밍을 할 수 있습니다.

## 결론

다운캐스팅이 실패할 수 있는 상황에 대비하여 올바른 처리를 함으로써 안전한 코드를 작성할 수 있습니다. 옵셔널 바인딩, 오류 처리, 기본 동작 정의 등의 방법을 활용하여 프로그램이 예기치 않은 동작을 하지 않도록 주의하는 것이 중요합니다.

자세한 내용은 [스위프트 공식 문서](https://docs.swift.org/swift-book/LanguageGuide/TypeCasting.html)를 참고하시기 바랍니다.