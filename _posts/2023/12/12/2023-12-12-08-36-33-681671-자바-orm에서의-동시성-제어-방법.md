---
layout: post
title: "[java] 자바 ORM에서의 동시성 제어 방법"
description: " "
date: 2023-12-12
tags: [java]
comments: true
share: true
---

자바에서 ORM(Object-Relational Mapping)을 사용하면 데이터베이스와의 상호작용을 추상화하여 객체 지향 언어로 데이터베이스를 다룰 수 있습니다. 그러나 ORM을 사용할 때 동시성 문제가 발생할 수 있습니다.

## 1. 동시성 문제란?

여러 스레드나 프로세스가 동시에 데이터를 읽거나 쓸 때 발생하는 문제입니다. 동시성 문제를 해결하지 않으면 데이터 불일치 문제가 발생할 수 있고, 애플리케이션의 안정성과 데이터 무결성이 위협받을 수 있습니다.

## 2. 자바 ORM의 동시성 문제

자바 ORM을 사용하면 여러 스레드나 트랜잭션이 각자의 엔티티 객체를 가지고 데이터베이스와 상호작용할 수 있습니다. 하지만 이로 인해 엔티티의 상태 변화가 충돌하거나, 반영되지 않을 수 있습니다.

## 3. 동시성 제어 방법

### 3.1 비관적 락

- **락(lock)**: 다중 스레드 환경에서 특정 자원에 대한 접근을 제어하기 위한 메커니즘.

비관적 락은 트랜잭션 시작 시에 데이터를 읽을 때 락을 걸고, 트랜잭션이 끝날 때 락을 해제하는 방식입니다. 이 방법은 데이터를 읽는 동안 다른 트랜잭션의 수정을 막을 수 있지만, 성능이 저하될 수 있습니다.

### 3.2 낙관적 락

낙관적 락은 트랜잭션 시작 시에 락을 걸지 않고, 트랜잭션이 끝나기 전까지 락을 걸지 않습니다. 대신 데이터의 변화가 발생하지 않았는지를 확인하는 방식으로 동시성 문제를 해결합니다. 만약 다른 트랜잭션에서 이미 데이터를 수정했다면 충돌이 발생하고, 이때는 롤백이나 다시 시도하는 등의 전략을 선택할 수 있습니다.

### 3.3 버전 관리

ORM에서는 버전 관리를 통해 여러 트랜잭션이 동시에 같은 엔티티를 수정할 때 충돌을 방지할 수 있습니다. 버전 관리는 각 엔티티마다 버전 정보를 기록하여 트랜잭션이 수정을 시도할 때 버전이 일치하는지를 확인합니다.

## 4. 결론

자바 ORM을 사용할 때 동시성 문제를 고려하여 적절한 동시성 제어 방법을 선택해야 합니다. 비관적 또는 낙관적 락, 버전 관리 등의 방법을 사용하여 데이터 불일치 문제를 해결하고, 안정적인 애플리케이션을 구축할 수 있습니다.

위의 예시들은 JPA(Java Persistence API)를 사용하는 경우의 동시성 제어 방법입니다. 현재 사용 중인 ORM에 따라 다른 동시성 제어 방법이 적용될 수 있습니다.

## 참고 자료

- [예제로 배우는 스프링 프레임워크](https://book.naver.com/bookdb/book_detail.nhn?bid=7772528) - 스프링 프레임워크와 ORM에 관한 내용이 소개되어 있습니다.
- [자바 ORM 표준 JPA 프로그래밍](https://book.naver.com/bookdb/book_detail.nhn?bid=9252681) - JPA에 대한 상세한 내용을 확인할 수 있습니다.