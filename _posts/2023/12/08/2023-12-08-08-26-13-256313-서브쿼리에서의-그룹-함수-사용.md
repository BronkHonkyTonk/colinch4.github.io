---
layout: post
title: "[sql] 서브쿼리에서의 그룹 함수 사용"
description: " "
date: 2023-12-08
tags: [sql]
comments: true
share: true
---

서브쿼리(subquery)는 SQL 문장 안에 중첩된 SELECT 문으로, 주요 쿼리의 FROM, WHERE, 혹은 HAVING 절에서 다른 SELECT 문을 실행하는 것을 의미합니다. 서브쿼리를 사용하면 복잡한 데이터 분석이나 집계를 수행할 수 있습니다. 서브쿼리 안에서는 주로 그룹 함수를 사용하여 집계를 수행하는데, 그룹 함수를 사용하는 방법에 대해 알아보겠습니다.

## 서브쿼리와 그룹 함수

서브쿼리 내에서 그룹 함수를 사용하는 경우, 해당 서브쿼리를 감싸는 주 쿼리에 영향을 미칠 수 있습니다. 이를테면, 서브쿼리에서의 그룹 함수 결과를 비교하여 주 쿼리의 출력을 결정하는 등 다양한 용도로 활용할 수 있습니다.

다음은 주 쿼리에서 서브쿼리를 사용하여 그룹 함수를 이용하는 간단한 예제입니다.

```sql
SELECT department, (SELECT COUNT(*) FROM employees WHERE department_id = d.id) AS emp_count
FROM departments d;
```

위 예제에서는 `departments` 테이블의 각 부서별로, 해당 부서에 속한 직원의 수를 서브쿼리를 통해 구하고 있습니다.

## 주의사항

서브쿼리 내에서 그룹 함수를 사용할 때에는 몇 가지 주의사항이 있습니다. 먼저, 서브쿼리의 결과가 여러 행을 반환한다면 오류가 발생할 수 있습니다. 따라서 그룹 함수를 사용할 때 서브쿼리가 예상대로 단일 값을 반환하는지 주의해야 합니다.

또한, 성능에 영향을 미칠 수 있기 때문에 서브쿼리 내에서의 그룹 함수 사용 시 주의가 필요합니다.

서브쿼리를 사용하여 그룹 함수를 포함한 데이터를 분석할 때에는 위의 주의사항을 숙지하고 안전하게 활용해야 합니다.

서브쿼리를 활용하여 다양한 데이터 분석 및 집계를 수행할 수 있는데, 이때 그룹 함수를 포함하여 활용하는 방법을 정확히 숙지하는 것이 중요합니다.